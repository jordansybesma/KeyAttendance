(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{104:function(e,t,a){e.exports=a(205)},109:function(e,t,a){},169:function(e,t,a){e.exports=a.p+"static/media/blank_profile_pic.9a344a6c.jpg"},190:function(e,t,a){},202:function(e,t,a){},205:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(27),i=a.n(r),o=(a(109),a(5)),c=a(6),l=a(9),u=a(7),d=a(8),h=a(220),p=a(166),m=a(165),f=a(119),b=a(148),v=a(221),g=a(207),y=a(13),k=a.n(y),w=a(16),S=a(224),O=a(98),E=a.n(O)()(),C="keyattendance.com",j="https";function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=window.localStorage.getItem("key_credentials");if(null!==a)return fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"JWT "+a},body:JSON.stringify(t)}).then(function(e){return e.status>=400?(403===e.status&&(P(),E.push("/")),{error:e.status,response:e.json()}):e.json()});E.push("/")}function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=window.localStorage.getItem("key_credentials");if(null!==a){var n=new FormData;return n.append("file",t.photo_value),n.append("student_id",t.student_id),n.append("info_id",t.info_id),fetch(e,{method:"POST",headers:{Authorization:"JWT "+a},body:n}).then(function(e){return e.status>=400?(403===e.status&&(P(),E.push("/")),{error:e.status,response:e.json()}):e.json()})}E.push("/")}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=window.localStorage.getItem("key_credentials");if(null!==a)return fetch(e,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"JWT "+a},body:JSON.stringify(t)}).then(function(e){return e.status>=400?(403===e.status&&(P(),E.push("/")),{error:e.status,response:e.json()}):e?e.json():void 0});E.push("/")}function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=window.localStorage.getItem("key_credentials");if(null!==a){var n=new FormData;return n.append("file",t.photo_value),n.append("student_id",t.student_id),n.append("info_id",t.info_id),n.append("id",t.id),fetch(e,{method:"PATCH",headers:{Authorization:"JWT "+a},body:n}).then(function(e){return e.status>=400?(403===e.status&&(P(),E.push("/")),{error:e.status,response:e.json()}):e.blob()})}E.push("/")}function M(e){var t=window.localStorage.getItem("key_credentials");if(null!==t)return fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"JWT "+t}}).then(function(e){return e.status>=400?(403===e.status&&(P(),E.push("/")),{error:e.status,response:e.json()}):e.json()});E.push("/")}function N(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=window.localStorage.getItem("key_credentials");if(null!==a)return fetch(e,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"JWT "+a},body:JSON.stringify(t)}).then(function(e){return e.status>=400?(403===e.status&&(P(),E.push("/")),{error:e.status,response:e.json()}):{}});E.push("/")}function A(e,t){return e.ordering<t.ordering?-1:e.ordering>t.ordering?1:0}function P(){window.localStorage.removeItem("key_credentials"),window.localStorage.removeItem("permissions")}function T(e){return U.apply(this,arguments)}function U(){return(U=Object(w.a)(k.a.mark(function e(t){var n,s,r,i,o,c,l,u,d,h,p,m,f,b,v,g,y,w=arguments;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=w.length>1&&void 0!==w[1]?w[1]:null,s=t===n||null===n?"".concat(j,"://").concat(C,"/api/attendance/?day=").concat(t):"".concat(j,"://").concat(C,"/api/attendance/?startdate=").concat(t,"&enddate=").concat(n),e.next=4,M(s);case 4:return r=e.sent,e.next=7,M("".concat(j,"://").concat(C,"/api/students/"));case 7:return i=e.sent,e.next=10,M("".concat(j,"://").concat(C,"/api/activities/"));case 10:if((o=e.sent).sort(A),0!==r.length&&0!==o.length){e.next=14;break}return e.abrupt("return");case 14:for(c={},l=0;l<o.length;l++)o[l].is_showing&&(c[o[l].name]={id:o[l].activity_id,ordering:o[l].ordering,type:o[l].type});for(u={},l=0;l<r.length;l++)null==u["".concat(r[l].student_id).concat(r[l].date)]&&(u["".concat(r[l].student_id).concat(r[l].date)]={date:r[l].date,id:r[l].student_id}),null!==r[l].str_value?u["".concat(r[l].student_id).concat(r[l].date)][r[l].activity_id]=r[l].str_value:null!==r[l].num_value?u["".concat(r[l].student_id).concat(r[l].date)][r[l].activity_id]=r[l].num_value:u["".concat(r[l].student_id).concat(r[l].date)][r[l].activity_id]="Y";for(d=[],h=["Date","First","Last","Student Key"],l=0;l<o.length;l++)o[l].is_showing&&h.push(o[l].name);p=Object.keys(u),l=0;case 23:if(!(l<p.length)){e.next=54;break}m=[],f=0;case 26:if(!(f<i.length)){e.next=35;break}if(i[f].id!==u[p[l]].id){e.next=32;break}return m[1]=i[f].first_name,m[2]=i[f].last_name,m[3]=null!==i[f].student_key?i[f].student_key:"N/A",e.abrupt("break",35);case 32:f++,e.next=26;break;case 35:f=0;case 36:if(!(f<h.length)){e.next=50;break}e.t0=h[f],e.next="Date"===e.t0?40:"First"===e.t0?42:"Last"===e.t0?43:"Student Key"===e.t0?44:45;break;case 40:return m[f]=u[p[l]].date,e.abrupt("break",47);case 42:case 43:case 44:return e.abrupt("break",47);case 45:b=c[h[f]],void 0===u[p[l]][b.id]?"boolean"===b.type?m[f]="N":m[f]="N/A":m[f]=u[p[l]][b.id];case 47:f++,e.next=36;break;case 50:d.push(m);case 51:l++,e.next=23;break;case 54:v=a(59),g=v.unparse({fields:h,data:d}),(y=document.createElement("a")).setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(g)),y.setAttribute("download","Attendance_".concat(t===n||null===n?t:"".concat(t,"_").concat(n),".csv")),y.style.display="none",document.body.appendChild(y),y.click(),document.body.removeChild(y);case 63:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function F(e,t,n){var s=a(59).unparse({fields:t,data:e}),r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(s)),r.setAttribute("download","".concat(n,".csv")),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}var R=function(e){var t=window.localStorage.getItem("key_credentials"),a=window.localStorage.getItem("permissions");return null===t||null===a?s.a.createElement(S.a,{to:"/"}):function(e){var t=e.split(".");return JSON.parse(atob(t[1]))}(t).exp<Date.now()/1e3?(P(),s.a.createElement(S.a,{to:"/"})):s.a.createElement(e,null)};function V(){var e=window.localStorage.getItem("permissions");return null!==e&&e.length>0?e.split(","):null}function W(e){e<0&&(console.error("Expected daysAgo to be a value >= 0 but recieved ",e),e=-e);var t=new Date;return t.setDate(t.getDate()-e),t}function H(e){var t=e.getDay();return e.setDate(e.getDate()-t),e}function L(e){var t=6-e.getDay();return e.setDate(e.getDate()+t),e}function B(e){return e.getFullYear().toString()+"-"+(e.getMonth()+1).toString()+"-"+e.getDate().toString()}var J=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleItemClick=function(e){return function(){a.props.history.push("/".concat(e))}},a.logout=function(){return function(){window.localStorage.removeItem("key_credentials"),window.localStorage.removeItem("permissions"),a.props.history.push("/")}},a.state={activeItem:"home"},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){if(!this.props.show)return this.props.children;var e=V(),t=[];e.indexOf("view_attendanceitems")>=0&&t.push(s.a.createElement(f.a,{key:0,onClick:this.handleItemClick("attendance")},"Attendance")),e.indexOf("view_students")>=0&&t.push(s.a.createElement(f.a,{key:1,onClick:this.handleItemClick("students")},"Students")),(e.indexOf("view_group")>=0||e.indexOf("view_user")>=0||e.indexOf("change_activity")>=0||e.indexOf("add_activity")>=0||e.indexOf("change_studentcolumn")>=0||e.indexOf("add_studentcolumn")>=0)&&t.push(s.a.createElement(f.a,{key:2,onClick:this.handleItemClick("admin")},"Admin")),e.indexOf("view_reports")>=0&&t.push(s.a.createElement(f.a,{key:3,onClick:this.handleItemClick("reports")},"Reports"));var a=s.a.createElement(b.a,null,t);return s.a.createElement("div",null,s.a.createElement(v.a,null,s.a.createElement(v.a.Header,null,s.a.createElement(v.a.Brand,{onClick:this.handleItemClick("attendance")},"Key"),s.a.createElement(v.a.Toggle,null)),s.a.createElement(v.a.Collapse,null,a,s.a.createElement(b.a,{pullRight:!0},s.a.createElement(f.a,{onClick:this.logout()},"Logout")))),this.props.children)}}]),t}(n.Component),K=Object(g.a)(J),Y=a(2),q=a(208),z=a(209),Q=a(210),$=a(223),G=a(211),X=a(212),Z=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={username:"",password:"",error:!1,firstLogin:!0},a.onUsernameChange=a.onUsernameChange.bind(Object(Y.a)(Object(Y.a)(a))),a.onPasswordChange=a.onPasswordChange.bind(Object(Y.a)(Object(Y.a)(a))),a.submit=a.submit.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){null!=localStorage.getItem("loggedIn")&&this.setState({firstLogin:!1})}},{key:"onUsernameChange",value:function(e){this.setState({username:e.target.value})}},{key:"onPasswordChange",value:function(e){this.setState({password:e.target.value})}},{key:"submit",value:function(e){var t=this;e.preventDefault(),fetch("".concat(j,"://").concat(C,"/api-token-auth/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.state.username,password:this.state.password})}).then(function(e){e.status>=400?t.setState({error:!0,username:"",password:""}):e.json().then(function(e){window.localStorage.setItem("key_credentials",e.token),window.localStorage.setItem("permissions",e.permissions),window.localStorage.setItem("loggedIn","true"),t.props.history.push("/attendance")})})}},{key:"render",value:function(){var e=this,t={textAlign:"center"};return null!==window.localStorage.getItem("key_credentials")?s.a.createElement(S.a,{to:"/attendance"}):s.a.createElement("div",{className:"center"},s.a.createElement("div",{className:"login-container"},s.a.createElement(q.a,null,s.a.createElement("h2",{style:t},"Key Attendance"),s.a.createElement("h4",{style:t},"Sign In"),s.a.createElement("form",{onSubmit:function(t){return e.submit(t)}},s.a.createElement(z.a,null,s.a.createElement(Q.a,null,"Username"),s.a.createElement($.a,{type:"text",value:this.state.username,placeholder:"Username",onChange:this.onUsernameChange}),s.a.createElement("br",null),s.a.createElement(Q.a,null,"Password"),s.a.createElement($.a,{type:"password",value:this.state.password,placeholder:"Password",onChange:this.onPasswordChange})),s.a.createElement(G.a,{block:!0,type:"submit",bsStyle:"primary"},"Continue"),s.a.createElement("br",null),this.state.error&&s.a.createElement(X.a,{bsStyle:"danger"},"Invalid username or password. Please try again."),!this.state.firstLogin&&s.a.createElement(X.a,{bsStyle:"info"},"You have been logged out.")))))}}]),t}(s.a.Component),ee=a(24),te=a.n(ee),ae=a(22),ne=function(e){function t(){var e,a;Object(o.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={isChecked:!1,value:"",activityType:""},a.toggleCheckboxChange=function(){var e=a.props,t=e.toggleCheckbox,n=e.label;t(a.state.isChecked,n,a.state.value,a.state.activityType)},a.handleChange=function(e){var t=e.target.name,n=e.target.value;a.setState(function(e){var a=Object(ae.a)({},e);return a[t]=n,a})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({isChecked:this.props.checked,value:this.props.value,activityType:this.props.activityType})}},{key:"componentDidUpdate",value:function(){this.props.checked!==this.state.isChecked&&this.setState({isChecked:this.props.checked,value:this.props.value,activityType:this.props.activityType})}},{key:"render",value:function(){var e,t=this.props.label,a=this.state,n=a.isChecked,r=a.value,i=a.activityType,o=s.a.createElement("span",{className:"checkbox"},s.a.createElement("label",null,s.a.createElement("input",{type:"checkbox",value:t,checked:n,onChange:this.toggleCheckboxChange}),t));return"boolean"===i?s.a.createElement("span",{className:"checkbox"},o):(e="string"===i?s.a.createElement("input",{type:"text",value:r,name:"value",disabled:n,onChange:this.handleChange}):s.a.createElement("input",{type:"number",value:r,disabled:n,name:"value",onChange:this.handleChange}),s.a.createElement("span",{className:"checkbox"},o,e))}}]),t}(n.Component),se=a(213),re=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).toggleCheckbox=function(e,t,n,s){var r=a.state,i=r.activities,o=r.studentID,c=r.numChecked,l=r.date,u=Object(Y.a)(Object(Y.a)(a)),d=i[t].activityID,h=i[t].attendanceItemID;if(e)1===c||N("".concat(j,"://").concat(C,"/api/attendance/?key=").concat(h)).then(function(e){if("error"in e){var a=e.error;e.response.then(function(e){u.setState({error:a,errorMsg:e.error})})}else i[t].value="boolean"!==s&&"",u.setState({activities:i,numChecked:c-1,error:"",errorMsg:""})});else{var p=new Date,m={student_id:o,activity_id:d,date:"".concat(l),time:"".concat(p.getHours(),":").concat(p.getMinutes()>=10?p.getMinutes():"0".concat(p.getMinutes()),":").concat(p.getSeconds()>=10?p.getSeconds():"0".concat(p.getSeconds()))};if("string"===s){if(""===n)return;m.str_value=n}else if("float"===s){if(""===n)return;m.num_value=n}_("".concat(j,"://").concat(C,"/api/attendance/"),m).then(function(e){if("error"in e){var a=e.error;e.response.then(function(e){u.setState({error:a,errorMsg:e.error})})}else"boolean"===s?i[t].value=!0:"string"===s?i[t].value=e.str_value:"float"===s&&(i[t].value=e.num_value),i[t].attendanceItemID=e.id,u.setState({activities:i,numChecked:c+1,error:"",errorMsg:""})})}},a.createCheckboxes=function(){for(var e=a.state.activities,t=Object.keys(e),n=[],r=0;r<t.length;r++){var i=e[t[r]].type,o=e[t[r]].value,c=void 0;c="boolean"===i?o:""!==o,n.push(s.a.createElement(ne,{label:t[r],key:t[r],activityType:i,value:o,checked:c,toggleCheckbox:a.toggleCheckbox}))}return n},a.state={activities:{},studentID:0,error:"",errorMsg:"",numChecked:0,date:""},a.toggleCheckbox=a.toggleCheckbox.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){for(var e=0,t=this.props.row.activities,a=Object.keys(t),n=0;n<a.length;n++)"boolean"===t[a[n]].type?!0===t[a[n]].value&&e++:""!==t[a[n]].value&&e++;this.setState({activities:t,studentID:this.props.row.studentID,numChecked:e,date:this.props.row.date})}},{key:"render",value:function(){var e="Your changes have not been saved. Please refresh and try again.";return""!==this.state.errorMsg&&null!==this.state.errorMsg&&(e=this.state.errorMsg),s.a.createElement("span",{className:"container"},s.a.createElement("span",{className:"row"},s.a.createElement("span",{className:"col-sm-12"},this.state.numChecked<2&&s.a.createElement(se.a,{bsStyle:"warning"},"At least one box must be checked"),""!==this.state.error&&s.a.createElement(se.a,{bsStyle:"danger"},"Error ",this.state.error,": ",e," "),this.createCheckboxes())))}}]),t}(s.a.Component),ie=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={row:{}},a.deleteRow=a.deleteRow.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({row:this.props.row})}},{key:"componentDidUpdate",value:function(){this.props.row.studentID!==this.state.row.studentID&&this.setState({row:this.props.row})}},{key:"deleteRow",value:function(){if(V().indexOf("delete_attendanceitems")<0)alert("Error: You are not authorized to delete attendance items");else{for(var e=this.state.row,t=e.activities,a=Object.keys(t),n=[],s=0;s<a.length;s++)0!==t[a[s]].attendanceItemID&&n.push(t[a[s]].attendanceItemID);for(var r=0;r<n.length;r++)N("".concat(j,"://").concat(C,"/api/attendance/?key=").concat(n[r]));this.props.CustomFunction(e.studentID)}}},{key:"render",value:function(){return s.a.createElement(G.a,{bsStyle:"danger",onClick:this.deleteRow},"Delete")}}]),t}(s.a.Component),oe=a(222),ce=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleInfoChange=function(e){var t=e.target.name,n=e.target.value,s=a.state.studentInfo;s[t]=n,a.setState({studentInfo:s})},a.state={firstName:"",lastName:"",show:!1,studentFields:{},studentInfo:{}},a.cancel=a.cancel.bind(Object(Y.a)(Object(Y.a)(a))),a.submit=a.submit.bind(Object(Y.a)(Object(Y.a)(a))),a.onFirstNameChange=a.onFirstNameChange.bind(Object(Y.a)(Object(Y.a)(a))),a.onLastNameChange=a.onLastNameChange.bind(Object(Y.a)(Object(Y.a)(a))),a.handleInfoChange=a.handleInfoChange.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(){if(this.props.show!==this.state.show){var e={},t=this.props.studentFields,a={};for(var n in t)e[t[n].name]="",a[t[n].name]=t[n];this.setState({show:this.props.show,studentFields:a,studentInfo:e})}}},{key:"validateInput",value:function(){var e=this.state,t=e.firstName,a=e.lastName;return t.length>0&&a.length>0?"success":0===t.length&&0===a.length?null:"error"}},{key:"onFirstNameChange",value:function(e){this.setState({firstName:e.target.value})}},{key:"onLastNameChange",value:function(e){this.setState({lastName:e.target.value})}},{key:"cancel",value:function(){this.setState({firstName:"",lastName:""}),this.props.onSubmit()}},{key:"createStudentInfo",value:function(e,t,a,n){var s=n.state.studentFields[e],r={student_id:a,info_id:s.info_id};return"str"===s.type?r.str_value=t:"int"===s.type?r.int_value=t:"date"===s.type&&(r.date_value=t),r}},{key:"submit",value:function(){var e=this;_("".concat(j,"://").concat(C,"/api/students/"),{first_name:this.state.firstName,last_name:this.state.lastName}).then(function(t){if("error"in t)console.log(t);else{var a=t.id,n=e.state.studentInfo,s=[];for(var r in n)""!==n[r]&&s.push(e.createStudentInfo(r,n[r],a,e));_("".concat(j,"://").concat(C,"/api/student_info/"),s).then(function(a){"error"in a?console.log(a):(e.setState({firstName:"",lastName:""}),e.props.onSubmit(t))})}})}},{key:"createStudentInfoFields",value:function(){var e=[],t=this.state.studentFields;for(var a in t){var n=t[a],r=void 0;switch(n.type){case"str":r="text";break;case"int":r="int";break;case"date":r="date"}e.push(s.a.createElement("div",{key:n.info_id},s.a.createElement(Q.a,null,a),s.a.createElement($.a,{value:this.state.studentInfo[a],name:a,type:r,onChange:this.handleInfoChange}),s.a.createElement("br",null)))}return e}},{key:"render",value:function(){return s.a.createElement(oe.a,{show:this.props.show},s.a.createElement(oe.a.Header,null,s.a.createElement(oe.a.Title,null,"Create New Student")),s.a.createElement(oe.a.Body,null,s.a.createElement("form",null,s.a.createElement(z.a,{controlId:"addStudentForm",validationState:this.validateInput()},s.a.createElement(Q.a,null,"First Name"),s.a.createElement($.a,{type:"text",value:this.state.firstName,placeholder:"First",onChange:this.onFirstNameChange}),s.a.createElement($.a.Feedback,null),s.a.createElement("br",null),s.a.createElement(Q.a,null,"Last Name"),s.a.createElement($.a,{type:"text",value:this.state.lastName,placeholder:"Last",onChange:this.onLastNameChange}),s.a.createElement("br",null),this.createStudentInfoFields(),s.a.createElement($.a.Feedback,null)))),s.a.createElement(oe.a.Footer,null,s.a.createElement(G.a,{onClick:this.cancel},"Cancel"),s.a.createElement(G.a,{onClick:this.submit,bsStyle:"primary"},"Create")))}}]),t}(s.a.Component),le=(a(190),a(214)),ue=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).onChange=function(e){var t=a.props.suggestions,n=e.currentTarget.value,s=t.filter(function(e){return!0===e.firstName.toLowerCase().startsWith(n.toLowerCase())||!0===e.lastName1.toLowerCase().startsWith(n.toLowerCase())||!0===e.lastName2.toLowerCase().startsWith(n.toLowerCase())||!0===(e.firstName.toLowerCase()+" "+e.lastName1.toLowerCase()+" ").startsWith(n.toLowerCase())||e.username&&!0===e.username.toLowerCase().startsWith(n.toLowerCase())});a.setState({activeSuggestion:0,filteredSuggestions:s,showSuggestions:!0,userInput:e.currentTarget.value})},a.onClick=function(e){a.setState({activeSuggestion:0,filteredSuggestions:[],showSuggestions:!1,userInput:e.currentTarget.innerText}),a.props.handler(e,e._targetInst.key),a.setState({userInput:""})},a.handleSubmit=function(e){e.preventDefault()},a.onKeyDown=function(e){var t=a.state,n=t.activeSuggestion,s=t.filteredSuggestions;if(13===e.keyCode&&-1===a.state.activeSuggestion)a.props.handler(e,a.state.selectedId),a.setState({userInput:""});else if(13===e.keyCode){if("object"===typeof s[n]){var r=s[n].firstName+" "+s[n].lastName1;a.setState({activeSuggestion:-1,showSuggestions:!1,userInput:r,selectedId:s[n].id})}}else if(38===e.keyCode){if(0===n)return;a.setState({activeSuggestion:n-1}),a.scrollUpHandler()}else if(40===e.keyCode){if(n===s.length-1)return;a.setState({activeSuggestion:n+1}),a.scrollDownHandler()}},a.state={activeSuggestion:0,filteredSuggestions:[],showSuggestions:!1,userInput:""},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"scrollDownHandler",value:function(){var e=document.getElementsByClassName("suggestions"),t=document.getElementsByClassName("suggestion-active")[0].getBoundingClientRect().height,a=e[0].scrollTop,n=e[0].getBoundingClientRect().height,s=Math.round(Math.round(n/t)/2)*t;(this.state.activeSuggestion+2)*t>=a+n&&(e[0].scrollTop=e[0].scrollTop+s)}},{key:"scrollUpHandler",value:function(){var e=document.getElementsByClassName("suggestions"),t=document.getElementsByClassName("suggestion-active")[0].getBoundingClientRect().height,a=e[0].scrollTop,n=e[0].getBoundingClientRect().height,s=Math.round(Math.round(n/t)/2)*t;(this.state.activeSuggestion-1)*t<=a&&(e[0].scrollTop=e[0].scrollTop-s)}},{key:"render",value:function(){var e,t=this.onChange,a=this.onClick,r=this.onKeyDown,i=this.handleSubmit,o=this.state,c=o.activeSuggestion,l=o.filteredSuggestions,u=o.showSuggestions,d=o.userInput;return u&&d&&(e=l.length?s.a.createElement("div",{className:"suggestions"},l.map(function(e,t){var n;t===c&&(n="suggestion-active");var r="";return e.username&&(r=" | "+e.username),s.a.createElement("p",{className:n,key:e.id,onClick:a},e.firstName," ",e.lastName1," ",e.lastName2," ",r)})):s.a.createElement("div",{className:"no-suggestions"},s.a.createElement("em",null,"No suggestions."))),s.a.createElement(n.Fragment,null,s.a.createElement(le.a,{inline:!0,onSubmit:i},s.a.createElement(z.a,{controlId:"formInlineName"},s.a.createElement(Q.a,null,void 0===this.props.label?"Search:":this.props.label)," ",s.a.createElement($.a,{autoComplete:"off",type:"text",value:d,onChange:t,onKeyDown:r,placeholder:this.props.hasUsername?"Name or Username":"Name"}),e)," "))}}]),t}(n.Component);ue.defaultProps={suggestions:[],handler:null};var de=ue,he=a(215),pe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={buildingCSV:!1,students:[],activities:[],attendanceItems:[],suggestionsArray:[],attendance:[],showStudentModal:!1,date:"",prevDate:"",canCreateStudent:!1,mobile:!1},a.downloadCSV=a.downloadCSV.bind(Object(Y.a)(Object(Y.a)(a))),a.addStudent=a.addStudent.bind(Object(Y.a)(Object(Y.a)(a))),a.removeAttendanceRow=a.removeAttendanceRow.bind(Object(Y.a)(Object(Y.a)(a))),a.openModal=a.openModal.bind(Object(Y.a)(Object(Y.a)(a))),a.closeModal=a.closeModal.bind(Object(Y.a)(Object(Y.a)(a))),a.updateDate=a.updateDate.bind(Object(Y.a)(Object(Y.a)(a))),a.setDateToToday=a.setDateToToday.bind(Object(Y.a)(Object(Y.a)(a))),a.refresh=a.refresh.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({date:this.getCurrentDate(),mobile:window.innerWidth<768})}},{key:"componentDidUpdate",value:function(){this.state.date!==this.state.prevDate&&(this.setState({prevDate:this.state.date}),this.fetchAndBuild())}},{key:"getCurrentDate",value:function(){var e=new Date,t=e.getMonth()+1,a=e.getDate();return"".concat(e.getFullYear(),"-").concat(t>=10?t:"0".concat(t),"-").concat(a>=10?a:"0".concat(a))}},{key:"fetchAndBuild",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t,a,n,s,r,i,o,c;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.date,e.prev=1,e.next=4,M("".concat(j,"://").concat(C,"/api/students/"));case 4:return a=e.sent,e.next=7,M("".concat(j,"://").concat(C,"/api/attendance/?day=").concat(t));case 7:return n=e.sent,e.next=10,M("".concat(j,"://").concat(C,"/api/activities/"));case 10:if(s=e.sent,r=V(),i=[],o=!1,!(r.indexOf("add_students")>=0)){e.next=19;break}return e.next=17,M("".concat(j,"://").concat(C,"/api/student_column/?quick_add=True"));case 17:i=e.sent,o=!0;case 19:(s=s.filter(function(e){return!0===e.is_showing})).sort(A),c=this.makeSuggestionsArray(a),this.setState({suggestionsArray:c,students:a,activities:s,studentFields:i,attendanceItems:n,canCreateStudent:o}),e.next=28;break;case 25:e.prev=25,e.t0=e.catch(1),console.log(e.t0);case 28:this.buildSheet();case 29:case"end":return e.stop()}},e,this,[[1,25]])}));return function(){return e.apply(this,arguments)}}()},{key:"buildSheet",value:function(){var e=this.state,t=e.activities,a=e.attendanceItems,n=e.students;console.log(a);for(var s={},r=0;r<a.length;r++)if(-1!==a[r].activity_id){null==s["".concat(a[r].student_id)]&&(s["".concat(a[r].student_id)]={time:a[r].time});var i=!0;null!==a[r].num_value?i=a[r].num_value:null!==a[r].str_value&&(i=a[r].str_value),s["".concat(a[r].student_id)][a[r].activity_id]={value:i,itemID:a[r].id}}console.log(s);var o=[],c=Object.keys(s),l=["Name"];for(r=0;r<t.length;r++)l.push(t[r].name);for(r=0;r<c.length;r++){for(var u={},d=0;d<n.length;d++)if(n[d].id===parseInt(c[r])){u.name="".concat(n[d].first_name," ").concat(n[d].last_name),u.studentID=n[d].id;break}u.time=s[c[r]].time,u.activities={};for(d=0;d<t.length;d++){var h=void 0;h=s[c[r]][t[d].activity_id]?s[c[r]][t[d].activity_id].value:"boolean"!==t[d].type&&"",u.activities[t[d].name]={value:h,activityID:t[d].activity_id,type:t[d].type,attendanceItemID:s[c[r]][t[d].activity_id]?s[c[r]][t[d].activity_id].itemID:0}}o.push(u)}this.setState({attendance:o})}},{key:"addStudent",value:function(){var e=Object(w.a)(k.a.mark(function e(t,a){var n,s,r,i,o,c,l,u;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchAndBuild();case 2:n=this.state,s=n.students,r=n.attendance,i=n.activities,o=n.date,c=new Date,l=this,u=0;case 6:if(!(u<r.length)){e.next=12;break}if(parseInt(a)!==r[u].studentID){e.next=9;break}return e.abrupt("return");case 9:u++,e.next=6;break;case 12:_("".concat(j,"://").concat(C,"/api/attendance/"),{student_id:a,activity_id:7,date:"".concat(o),time:"".concat(c.getHours(),":").concat(c.getMinutes()>=10?c.getMinutes():"0".concat(c.getMinutes()),":").concat(c.getSeconds()>=10?c.getSeconds():"0".concat(c.getSeconds()))}).then(function(e){if("error"in e)e.response.then(function(e){alert("Error: ".concat(e.error))});else{for(var t="",n=0;n<s.length;n++)if(s[n].id===parseInt(a)){t="".concat(s[n].first_name," ").concat(s[n].last_name);break}var o={};for(n=0;n<i.length;n++){var c=i[n].type,u="boolean"!==c&&"";o[i[n].name]={activityID:i[n].activity_id,attendanceItemID:0,value:u,type:c}}o.Key.value=!0,o.Key.attendanceItemID=e.id;var d={name:t,studentID:parseInt(a),time:e.time,activities:o};r.push(d),l.setState({attendance:r})}});case 13:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"makeSuggestionsArray",value:function(e){var t,a,n,s=[];for(var r in e)e[r].last_name.includes(" ")?(t=(n=e[r].last_name.split(" "))[0],a=n[1]):(t=e[r].last_name,a=""),s.push({firstName:e[r].first_name,lastName1:t,lastName2:a,id:e[r].id});return s}},{key:"downloadCSV",value:function(){var e=Object(w.a)(k.a.mark(function e(){return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({buildingCSV:!0}),e.next=3,T("".concat(this.state.date));case 3:this.setState({buildingCSV:!1});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"removeAttendanceRow",value:function(e){for(var t=this.state.attendance,a=0;a<t.length;a++)t[a].studentID===e&&t.splice(a,1);this.setState({attendance:t})}},{key:"openModal",value:function(){this.setState({showStudentModal:!0})}},{key:"refresh",value:function(){this.fetchAndBuild()}},{key:"closeModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.state.students,a=[];null!==e&&(t.push({first_name:e.first_name,last_name:e.last_name,id:e.id}),a=this.makeSuggestionsArray(t),this.addStudent(null,e.id)),this.setState({showStudentModal:!1,students:t,suggestions:a})}},{key:"updateDate",value:function(e){this.setState({date:e.target.value})}},{key:"setDateToToday",value:function(){this.setState({date:this.getCurrentDate()})}},{key:"render",value:function(){var e=this;if(V().indexOf("view_attendanceitems")<0)return s.a.createElement(S.a,{to:"/notfound"});console.log(this.state.attendance);var t,a=this.state.attendance.map(function(t){return{name:t.name,time:t.time,activities:t.activities,studentID:t.studentID,date:e.state.date}}).sort(function(e,t){return t.time.localeCompare(e.time)}),n=[{accessor:"name",label:"Name",priorityLevel:1,position:1,minWidth:100,sortable:!0},{accessor:"time",label:"Check-in Time",priorityLevel:2,position:2,minWidth:100,sortable:!0},{accessor:"options",label:"Options",priorityLevel:3,position:3,CustomComponent:ie,sortable:!1,minWidth:100},{accessor:"activities",label:"Activities",priorityLevel:4,position:4,minWidth:2e3,CustomComponent:re,sortable:!1}],r=this.state.buildingCSV;return t=this.state.canCreateStudent?s.a.createElement(he.a,{style:{float:"right"}},s.a.createElement(G.a,{onClick:this.refresh},"Refresh"),!this.state.mobile&&s.a.createElement(G.a,{onClick:this.setDateToToday},"Go To Today"),!this.state.mobile&&s.a.createElement(G.a,{onClick:this.downloadCSV,disabled:r},r?"Downloading...":"Download"),s.a.createElement(G.a,{onClick:this.openModal},"Create New Student")):s.a.createElement(he.a,{style:{float:"right"}},s.a.createElement(G.a,{onClick:this.refresh},"Refresh"),!this.state.mobile&&s.a.createElement(G.a,{onClick:this.setDateToToday},"Go To Today"),!this.state.mobile&&s.a.createElement(G.a,{onClick:this.downloadCSV,disabled:r},r?"Downloading...":"Download")),s.a.createElement("div",{className:"content"},s.a.createElement(ce,{studentFields:this.state.studentFields,show:this.state.showStudentModal,onSubmit:this.closeModal}),s.a.createElement("h1",null,"Attendance for ",this.state.date),s.a.createElement("br",null),t,!this.state.mobile&&s.a.createElement(le.a,{inline:!0,style:{float:"right",paddingRight:"5px",paddingLeft:"5px"}},s.a.createElement(z.a,null,s.a.createElement(Q.a,null,"Date:")," ",s.a.createElement($.a,{onChange:this.updateDate,value:this.state.date,type:"date"}))),s.a.createElement(de,{label:"Check-in Student:",suggestions:this.state.suggestionsArray,handler:this.addStudent}),s.a.createElement("br",null),s.a.createElement(te.a,{rows:a,columns:n,column:"time",direction:"descending",showPagination:!0,callbacks:{options:this.removeAttendanceRow}}))}}]),t}(s.a.Component),me=a(204),fe=a(216),be=a(28),ve=a(168),ge=a.n(ve),ye=(a(202),function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={data:e.data,yArrayStudents:["1","2","3","4","5"]},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"setYArrayRange",value:function(e){try{if("Thu"===e[0].y)return["Thu","Fri","Sat","Sun","Mon","Tue","Wed"];if("Fri"===e[0].y)return["Fri","Sat","Sun","Mon","Tue","Wed","Thu"];if("Sat"===e[0].y)return["Sat","Sun","Mon","Tue","Wed","Thu","Fri"];if("Sun"===e[0].y)return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];if("Mon"===e[0].y)return["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];if("Tue"===e[0].y)return["Tue","Wed","Thu","Fri","Sat","Sun","Mon"];if("Wed"===e[0].y)return["Wed","Thu","Fri","Sat","Sun","Mon","Tue"]}catch(t){console.log(t)}}},{key:"scaleWidth",value:function(e,t){return"weekly"===e||"individualStudent"===e?8*t:"annual"===e?3.2*t:void 0}},{key:"scaleHeight",value:function(e){return"weekly"===e||"individualStudent"===e?300:"annual"===e?350:void 0}},{key:"axisType",value:function(e){return"ordinal"}},{key:"colorRange",value:function(e,t){for(var a=0;a<e.length;a++)if("individualStudent"===t&&0!==e[a].color||("weekly"===t||"annual"===t)&&0!==e[a].color)return["#F5FBFD","teal"];return["#F5FBFD","#F5FBFD"]}},{key:"reverseYAxis",value:function(e,t){if("individualStudent"===e)return this.state.yArrayStudents.map(function(e){return e}).reverse();try{return t.map(function(e){return e}).reverse()}catch(a){console.log(a)}}},{key:"calculateMinDataPoint",value:function(e){for(var t,a=0,n=0;n<e.length;n++)(t=e[n].color)&&t<a&&(a=t);return a}},{key:"calculateMaxDataPoint",value:function(e){for(var t,a=0,n=0;n<e.length;n++)(t=e[n].color)&&t>a&&(a=t);return a}},{key:"calculateHeatmapColor",value:function(e){return 0===e?"#F5FBFD":"teal"}},{key:"render",value:function(){var e=this.props.data,t=e.length,a=this.props.heatMapType,n=this.calculateMinDataPoint(e),r=this.calculateMaxDataPoint(e),i=this.calculateHeatmapColor(r),o=this.setYArrayRange(e);return s.a.createElement("div",null,s.a.createElement("div",{style:{margin:20}},s.a.createElement(be.e,{width:this.scaleWidth(a,t),height:this.scaleHeight(a),margin:{top:30,left:45},xType:"ordinal",yType:this.axisType(a),yDomain:this.reverseYAxis(a,o)},s.a.createElement(be.d,{orientation:"top"}),s.a.createElement(be.f,{orientation:"left"}),s.a.createElement(be.a,{className:"heatmap-series-example",colorRange:this.colorRange(e,a),data:e,style:{stroke:"black",strokeWidth:"1px",rectStyle:{rx:1,ry:1}}}))),s.a.createElement(ge.a,{width:300,startTitle:n,midTitle:Math.round((r+n)/2),endTitle:r,startColor:"#F5FBFD",endColor:i,height:100}))}}]),t}(n.Component));ye.defaultProps={data:[],heatMapType:""};var ke=ye,we=a(169),Se=a.n(we),Oe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).renderDisplayInfo=function(){var e=[],t=a.state.profileInfo;for(var n in t)if(!0===t[n].colInfo.is_showing){var r="N/A";null!==t[n].value&&null!==t[n].value!==""&&(r=t[n].value);var i=t[n].colInfo.name+": "+r;e.push(s.a.createElement(me.a,{key:n},i))}return e},a.renderEditInfo=function(){var e=[];for(var t in a.state.profileInfo){var n=a.state.profileInfo[t].colInfo.name+": ";if(a.state.profileInfo[t].colInfo.is_showing){e.push(s.a.createElement(se.a,{key:t+"label"},n));var r=a.state.profileInfo[t].colInfo.type;e.push(s.a.createElement($.a,{key:n,type:r,id:t,defaultValue:a.state.profileInfo[t].value,onChange:function(e){return a.handleInfoChange(e,a.state)}})),e.push(s.a.createElement("br",{key:t+"break"}))}}return e},a.getPic=function(){return a.state.uploadedPic?a.state.src:Se.a},a.state={mode:"search",canViewStudentInfo:!1,canViewHeatmap:!1,canDeleteStudent:!1,heatMapJson:[]},a.display=a.display.bind(Object(Y.a)(Object(Y.a)(a))),a.edit=a.edit.bind(Object(Y.a)(Object(Y.a)(a))),a.handler=a.handler.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t,a,n,s,r,i,o,c,l;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M("".concat(j,"://").concat(C,"/api/students/"));case 3:if(t=e.sent,a=this.makeSuggestionsArray(t),n=V(),s=!1,!(n.indexOf("view_studentinfo")>=0)){e.next=14;break}return e.next=10,M("".concat(j,"://").concat(C,"/api/student_column/"));case 10:r=e.sent,i=this.parseCols(r),o=this.parseCols(r),s=!0;case 14:c=!1,n.indexOf("view_reports")>=0&&(c=!0),l=!1,n.indexOf("delete_students")>=0&&(l=!0),this.setState(function(e,t){return{mode:"search",suggestionsArray:a,studentColumnJson:r,profileInfo:i,profileInfoPrelim:o,id:null,canViewStudentInfo:s,canViewHeatmap:c,uploadedPic:!1,src:null,picUpdated:!1,canDeleteStudent:l}}),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(0),console.log(e.t0);case 24:case"end":return e.stop()}},e,this,[[0,21]])}));return function(){return e.apply(this,arguments)}}()},{key:"makeSuggestionsArray",value:function(e){var t,a,n,s=[];for(var r in e)e[r].last_name.includes(" ")?(t=(n=e[r].last_name.split(" "))[0],a=n[1]):(t=e[r].last_name,a=""),s.push({firstName:e[r].first_name,lastName1:t,lastName2:a,id:e[r].id});return s}},{key:"parseCols",value:function(e){e.sort(this.sortCols);var t=[];for(var a in e)t[a]={studentInfoId:null,colInfo:e[a],value:null,type:null,updated:!1,patchPost:{student_id:null,info_id:parseInt(a)+1,int_value:null,str_value:null,bool_value:null,date_value:null,time_value:null,photo_value:null,id:null}};return t}},{key:"sortCols",value:function(e,t){return e.info_id>t.info_id?1:e.info_id<t.info_id?-1:0}},{key:"handler",value:function(e,t){var a={mode:"display",id:t,profileInfo:this.state.profileInfo,profileInfoPrelim:this.state.profileInfoPrelim};this.getStudentProfile(a)}},{key:"getStudentProfile",value:function(){var e=Object(w.a)(k.a.mark(function e(t){var a,n,s,r,i,o,c,l,u,d,h,p,m;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M("".concat(j,"://").concat(C,"/api/students/?id=")+t.id);case 3:return a=e.sent,t.profileData=a,e.next=7,M("".concat(j,"://").concat(C,"/api/student_info/?student_id=").concat(t.id));case 7:for(s in n=e.sent)console.log(this.state.picUpdated),null!==n[s].photo_url&&0==this.state.picUpdated&&(r="".concat(j,"://").concat(C,"/").concat(n[s].photo_url),this.setState({src:r,uploadedPic:!0}),console.log("src"),console.log(t.src));if(this.setState({picUpdated:!1}),t.profileDataPrelim=JSON.parse(JSON.stringify(a)),!this.state.canViewStudentInfo){e.next=42;break}return e.prev=12,e.next=15,M("".concat(j,"://").concat(C,"/api/student_info/?student_id=").concat(t.id));case 15:if(0!==(i=e.sent).length){e.next=25;break}return e.next=19,M("".concat(j,"://").concat(C,"/api/student_column/"));case 19:o=e.sent,t.profileInfo=this.parseCols(o),t.profileInfoPrelim=this.parseCols(o),t=this.addTypes(t),e.next=34;break;case 25:return e.next=27,M("".concat(j,"://").concat(C,"/api/student_column/"));case 27:o=e.sent,t.profileInfo=this.parseCols(o),t.profileInfoPrelim=this.parseCols(o),t=this.addTypes(t),c=this.parseStudentInfo(t,i),t.profileInfo=c.profileInfo,t.profileInfoPrelim=c.profileInfoPrelim;case 34:e.next=42;break;case 36:return e.prev=36,e.t0=e.catch(12),e.next=40,M("".concat(j,"://").concat(C,"/api/student_column/"));case 40:o=e.sent,t.profileInfo=this.parseCols(o);case 42:if(l=H(l=W(28)),u=B(l),t.startDateString=u,d=W(0),h=L(d),p=B(h),t.endDateString=p,!this.state.canViewHeatmap){e.next=55;break}return e.next=53,M("".concat(j,"://").concat(C,"/api/reports/individualHeatmap/?student_id=").concat(t.id,"&startdate=").concat(u,"&enddate=").concat(p));case 53:m=e.sent,t.heatMapJson=m;case 55:this.setState(function(e,a){return t}),e.next=61;break;case 58:e.prev=58,e.t1=e.catch(0),console.log(e.t1);case 61:case"end":return e.stop()}},e,this,[[0,58],[12,36]])}));return function(t){return e.apply(this,arguments)}}()},{key:"updateStudentInfo",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t,a;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M("".concat(j,"://").concat(C,"/api/student_info/?student_id=").concat(this.state.id));case 2:t=e.sent,a=this.parseStudentInfo(this.state,t),this.setState(function(e,t){return{profileInfo:a.profileInfo,profileInfoPrelim:a.profileInfoPrelim}});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addTypes",value:function(e){for(var t in e.profileInfo)e.profileInfo[t].patchPost.student_id=e.id,e.profileInfoPrelim[t].patchPost.student_id=e.id,/varchar.*/g.test(e.profileInfo[t].colInfo.type)?(e.profileInfo[t].type="str_value",e.profileInfoPrelim[t].type="str_value"):(e.profileInfo[t].type=e.profileInfo[t].colInfo.type+"_value",e.profileInfoPrelim[t].type=e.profileInfo[t].colInfo.type+"_value");return e}},{key:"parseStudentInfo",value:function(e,t){for(var a in e.profileInfo){var n;e.profileInfo[a].patchPost.student_id=e.id,e.profileInfoPrelim[a].patchPost.student_id=e.id,/varchar.*/g.test(e.profileInfo[a].colInfo.type)?(e.profileInfo[a].type="str_value",e.profileInfoPrelim[a].type="str_value"):(e.profileInfo[a].type=e.profileInfo[a].colInfo.type+"_value",e.profileInfoPrelim[a].type=e.profileInfo[a].colInfo.type+"_value")}for(var s in t){var r=t[s].info_id;e.profileInfo[r-1].patchPost=t[s],e.profileInfoPrelim[r-1].patchPost=t[s],e.profileInfo[r-1].studentInfoId=t[s].id,e.profileInfoPrelim[r-1].studentInfoId=t[s].id,n=e.profileInfo[r-1].type,e.profileInfo[r-1].value=t[s][n],e.profileInfoPrelim[r-1].value=t[s][n]}return e}},{key:"search",value:function(){var e={mode:"search",id:this.state.id,profileInfo:this.state.profileInfo,profileInfoPrelim:this.state.profileInfoPrelim};this.getStudentProfile(e)}},{key:"display",value:function(){var e={mode:"display",id:this.state.id,profileInfo:this.state.profileInfo,profileInfoPrelim:this.state.profileInfoPrelim};this.getStudentProfile(e)}},{key:"edit",value:function(){this.setState({mode:"edit"})}},{key:"delete",value:function(){var e=Object(w.a)(k.a.mark(function e(t,a){var n,s,r,i,o,c;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n={mode:"search",id:this.state.id,profileInfo:this.state.profileInfo,profileInfoPrelim:this.state.profileInfoPrelim},e.prev=2,e.next=5,M("".concat(j,"://").concat(C,"/api/student_info/?student_id=").concat(a.id));case 5:if(0!==(s=e.sent).length){e.next=14;break}return e.next=9,M("".concat(j,"://").concat(C,"/api/student_column/"));case 9:r=e.sent,n.profileInfo=this.parseCols(r),n=this.addTypes(n),e.next=21;break;case 14:return e.next=16,M("".concat(j,"://").concat(C,"/api/student_column/"));case 16:r=e.sent,n.profileInfo=this.parseCols(r),n=this.addTypes(n),i=this.parseStudentInfo(n,s),n.profileInfo=i.profileInfo;case 21:e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(2),e.next=27,M("".concat(j,"://").concat(C,"/api/student_column/"));case 27:r=e.sent,n.profileInfo=this.parseCols(r);case 29:for(N("".concat(j,"://").concat(C,"/api/students/"),a.profileData),o=!1,c=0;!1===o;)a.suggestionsArray[c].id===a.profileData.id?(a.suggestionsArray.splice(c,1),o=!0):c++;this.state.mode="search",this.setState(function(e,t){return a});case 35:case"end":return e.stop()}},e,this,[[2,23]])}));return function(t,a){return e.apply(this,arguments)}}()},{key:"handleNameChange",value:function(e,t){var a=e.target.id;t.profileDataPrelim[a]=e.target.value,t.profileDataUpdated=!0,this.setState(function(e,a){return t})}},{key:"handleInfoChange",value:function(e,t){var a=parseInt(e.target.id),n=e.target.value,s=t.profileInfoPrelim[a].type;t.profileInfoPrelim[a].updated=!0,""===n&&(n=null),t.profileInfoPrelim[a].value=n,t.profileInfoPrelim[a].patchPost[s]=n,this.setState(function(e,a){return t})}},{key:"handleSubmit",value:function(e,t){e.preventDefault(),x("".concat(j,"://").concat(C,"/api/students/"),t.profileData).then(function(e){"error"in e&&e.response.then(function(e){alert("Error: ".concat(e.error))})}),t.profileInfo=t.profileInfoPrelim,t.profileDataUpdated&&(t.profileData=JSON.parse(JSON.stringify(t.profileDataPrelim)),x("".concat(j,"://").concat(C,"/api/students/"),t.profileData));var a=!1;for(var n in t.profileInfo){(n=t.profileInfo[n]).updated&&(n.studentInfoId?"photopath"==n.colInfo.name?I("".concat(j,"://").concat(C,"/api/student_info/?id=")+n.studentInfoId,n.patchPost).then(function(e){"error"in e&&e.response.then(function(e){alert("Error: ".concat(e.error))})}):x("".concat(j,"://").concat(C,"/api/student_info/?id=")+n.studentInfoId,n.patchPost).then(function(e){"error"in e&&e.response.then(function(e){alert("Error: ".concat(e.error))})}):(n.patchPost.student_id=t.id,"photopath"==n.colInfo.name?D("".concat(j,"://").concat(C,"/api/student_info/"),n.patchPost).then(function(e){"error"in e?e.response.then(function(e){alert("Error: ".concat(e.error))}):a=!0}):_("".concat(j,"://").concat(C,"/api/student_info/"),n.patchPost).then(function(e){"error"in e?e.response.then(function(e){alert("Error: ".concat(e.error))}):a=!0})))}a&&this.updateStudentInfo();for(var s=!1,r=0;!1===s;)t.suggestionsArray[r].id===t.profileData.id?(t.suggestionsArray[r]={firstName:t.profileData.first_name,id:t.profileData.id,lastName1:t.profileData.last_name,lastName2:""},s=!0):r++;this.getStudentProfile(t),this.renderDisplayInfo(this.state.profileInfo),t.id=t.profileData.id,t.mode="display",this.setState(function(e,a){return t})}},{key:"sameDay",value:function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}},{key:"compareTime",value:function(e,t){return new Date(e)>new Date(t)}},{key:"formatData",value:function(e){var t,a=e.startDateString,n=e.endDateString,s=new Date(a.replace(/-/g,"/")),r=new Date(n.replace(/-/g,"/")),i=s,o=0,c=this.state.heatMapJson;if(0===c.length){var l={date:a,daily_visits:0};c.push(l)}for(;!1===this.compareTime(i,r);){if(o>c.length-1&&(o=c.length-1),t=new Date(c[o].date.replace(/-/g,"/")),!1===this.sameDay(i,t)){var u={date:i.toISOString().slice(0,10),daily_visits:0};o!==c.length-1||this.compareTime(t,i)?c.splice(o,0,u):c.splice(o+1,0,u)}i.setDate(i.getDate()+1),o++}for(var d,h=[],p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],m=0;m<c.length;m++)d={x:p[new Date(c[m].date.replace(/-/g,"/")).getDay()],y:(Math.floor(m/7)+1).toString(),color:c[m].daily_visits},h.push(d);return h}},{key:"readImage",value:function(e,t){e.preventDefault(),this.setState({picUpdated:!1}),t.profileInfo=JSON.parse(JSON.stringify(t.profileInfoPrelim)),t.profileInfoPrelim[5].value=e.target.files[0],t.profileInfoPrelim[5].updated=!0,t.profileInfoPrelim[5].patchPost.photo_value=e.target.files[0],this.setState(function(e,a){return t})}},{key:"render",value:function(){var e=this;if(V().indexOf("view_students")<0)return s.a.createElement(S.a,{to:"/attendance"});if("search"===this.state.mode)return s.a.createElement("div",{className:"content"},s.a.createElement("h1",null," Key Students "),s.a.createElement("div",{className:"container-fluid no-padding"},s.a.createElement("div",{className:"row justify-content-start"},s.a.createElement("div",{className:"col-md-12 to-front top-bottom-padding"},s.a.createElement(de,{suggestions:this.state.suggestionsArray,handler:this.handler})))));if("display"===this.state.mode){var t=[];return this.state.canViewHeatmap&&(t=s.a.createElement("div",null,s.a.createElement("h3",null,"Student Attendance"),s.a.createElement("p",null,"Number of engagements for this individual student in the past month."),s.a.createElement("p",null,s.a.createElement("b",null,"Note:")," Data is displayed chronologically, with row 1 representing the oldest week and row 5 representing the current week."),s.a.createElement(ke,{data:this.formatData(this.state),heatMapType:"individualStudent"}))),s.a.createElement("div",{className:"content"},s.a.createElement("h1",null," Student Profile "),s.a.createElement("div",{className:"container-fluid no-padding"},s.a.createElement("div",{className:"row justify-content-start"},s.a.createElement("div",{className:"col-md-4 to-front top-bottom-padding"},s.a.createElement(de,{suggestions:this.state.suggestionsArray,handler:this.handler})),s.a.createElement("div",{className:"col-md-8 top-bottom-padding"},s.a.createElement("img",{id:"studentPhoto",src:this.getPic(this.state.parsedInfo),width:"196",height:"196"}),s.a.createElement("br",null),s.a.createElement(fe.a,null,s.a.createElement(me.a,null,"Name: ",this.state.profileData.first_name," ",this.state.profileData.last_name),this.renderDisplayInfo(this.state.parsedInfo)),s.a.createElement(G.a,{variant:"btn btn-primary",onClick:this.edit},"Edit")))),t)}if("edit"===this.state.mode){var a=[];return this.state.canDeleteStudent&&(a=s.a.createElement(he.a,null,s.a.createElement(G.a,{bsStyle:"danger",onClick:function(t){window.confirm("Are you sure you wish to delete this student?")&&e.delete(t,e.state)}},"Delete"))),s.a.createElement("div",{className:"content"},s.a.createElement("h1",null," Student Profile "),s.a.createElement("div",{className:"container-fluid no-padding"},s.a.createElement("div",{className:"row justify-content-start"},s.a.createElement("div",{className:"col-md-4 to-front top-bottom-padding"},s.a.createElement(de,{suggestions:this.state.suggestionsArray,handler:this.handler})),s.a.createElement("div",{className:"col-md-8 top-bottom-padding"},s.a.createElement("img",{id:"studentPhoto",src:this.getPic(this.state.parsedInfo),width:"196",height:"196"}),s.a.createElement("p",null," Upload Student Profile Photo "),s.a.createElement("input",{id:"upload-button",type:"file",accept:"image/*",name:this.state.profileInfo[0].patchPost.student_id,onChange:function(t){return e.readImage(t,e.state)}}),s.a.createElement("br",null),s.a.createElement(le.a,{inline:!0,className:"col-md-8 top-bottom-padding",onSubmit:function(t){return e.handleSubmit(t,e.state)}},s.a.createElement(z.a,null,s.a.createElement(se.a,null,"First Name: "),s.a.createElement($.a,{type:"text",id:"first_name",defaultValue:this.state.profileData.first_name,onChange:function(t){return e.handleNameChange(t,e.state)}})," ",s.a.createElement("br",null),s.a.createElement(se.a,null,"Last Name: "),s.a.createElement($.a,{type:"text",id:"last_name",defaultValue:this.state.profileData.last_name,onChange:function(t){return e.handleNameChange(t,e.state)}})," ",s.a.createElement("br",null),this.renderEditInfo(this.state.parsedInfo),s.a.createElement("br",null),s.a.createElement(he.a,null,s.a.createElement(G.a,{bsStyle:"primary",type:"submit"},"Submit"),s.a.createElement(G.a,{bsStyle:"default",onClick:this.display},"Cancel")),s.a.createElement("br",null),a))))))}}}]),t}(n.Component),Ee=a(217),Ce=a(226),je=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={data:e.data},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.data;return s.a.createElement(be.e,{xType:"ordinal",width:400,height:350,yDomain:[0,350]},s.a.createElement(be.d,null),s.a.createElement(be.f,null),s.a.createElement(be.c,{data:e}),s.a.createElement(be.b,{data:e.map(function(e){return Object(ae.a)({},e,{label:e.y.toString()})}),labelAnchorX:"middle",labelAnchorY:"text-after-edge"}))}}]),t}(s.a.Component);je.defaultProps={data:[]};var _e=je,De=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={activities:[],activityName:"",activityNumber:0,buildingCSV:!1,startDate:"",endDate:""},a.handleActivityDropdownSelect=a.handleActivityDropdownSelect.bind(Object(Y.a)(Object(Y.a)(a))),a.updateEndDate=a.updateEndDate.bind(Object(Y.a)(Object(Y.a)(a))),a.updateStartDate=a.updateStartDate.bind(Object(Y.a)(Object(Y.a)(a))),a.downloadCSV=a.downloadCSV.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"downloadCSV",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t,a,n,s,r,i,o,c,l,u,d,h,p,m,f;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state,a=t.startDate,n=t.endDate,s=t.activityNumber,r=t.activityName,""!==a&&""!==n){e.next=3;break}return e.abrupt("return");case 3:return this.setState({buildingCSV:!0}),i=[],o=["Date","Student Name","Student Key"],c="".concat(r,"_").concat(a,"-").concat(n),e.next=9,M("".concat(j,"://").concat(C,"/api/reports/byActivityAttendance/?startdate=").concat(a,"&enddate=").concat(n,"&activity=").concat(s));case 9:return l=e.sent,e.next=12,M("".concat(j,"://").concat(C,"/api/students/"));case 12:for(d in u=e.sent,l){for(m in h="",p="",u)u[m].id===l[d].student_id&&(h=u[m].first_name+" "+u[m].last_name,p=u[m].student_key);(f=[])[0]=l[d].date,f[1]=h,f[2]=null===p?"N/A":p,i.push(f)}return e.next=16,F(i,o,c);case 16:this.setState({buildingCSV:!1});case 17:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"updateStartDate",value:function(e){this.setState({startDate:e.target.value})}},{key:"updateEndDate",value:function(e){this.setState({endDate:e.target.value})}},{key:"componentDidMount",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M("".concat(j,"://").concat(C,"/api/activities/"));case 2:t=e.sent,this.setState({activities:t,activityName:t[0].name,activityNumber:t[0].activity_id});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleActivityDropdownSelect",value:function(e){var t=this.state.activities,a=e.target.value,n=0;for(var s in t)t[s].name===a&&(n=t[s].activity_id);this.setState({activityName:a,activityNumber:n})}},{key:"render",value:function(){var e=this.state.activities.map(function(e,t){return s.a.createElement("option",{value:e.name,key:"item".concat(t)},e.name)}),t=this.state.buildingCSV;return s.a.createElement("div",null,s.a.createElement("h3",null," Download Attendance by Program "),s.a.createElement("p",null,"Downloads a spreadsheet containing all attendance records between two dates for a given program."),s.a.createElement(le.a,{inline:!0,style:{paddingRight:"5px",paddingLeft:"5px"}},s.a.createElement(z.a,null,s.a.createElement(Q.a,null,"Program: ")," ",s.a.createElement($.a,{componentClass:"select",name:"type",onChange:this.handleActivityDropdownSelect,defaultValue:"string"},e),"  ",s.a.createElement(Q.a,null,"Start Date:")," ",s.a.createElement($.a,{onChange:this.updateStartDate,value:this.state.startDate,type:"date"}),"  ",s.a.createElement(Q.a,null,"End Date:")," ",s.a.createElement($.a,{onChange:this.updateEndDate,value:this.state.endDate,type:"date"}),"  ",s.a.createElement(G.a,{onClick:this.downloadCSV,disabled:t},t?"Downloading...":"Download"))))}}]),t}(s.a.Component),xe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={buildingCSV:!1,startDate:"",endDate:""},a.updateEndDate=a.updateEndDate.bind(Object(Y.a)(Object(Y.a)(a))),a.updateStartDate=a.updateStartDate.bind(Object(Y.a)(Object(Y.a)(a))),a.downloadCSV=a.downloadCSV.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"downloadCSV",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t,a,n,s,r,i,o,c,l,u,d,h,p;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state,a=t.startDate,n=t.endDate,""!==a&&""!==n){e.next=3;break}return e.abrupt("return");case 3:return this.setState({buildingCSV:!0}),s=[],r=["Student Name","Student Key"],i="New_Students_".concat(a,"-").concat(n),e.next=9,M("".concat(j,"://").concat(C,"/api/reports/newStudents/?startdate=").concat(a,"&enddate=").concat(n));case 9:return o=e.sent,e.next=12,M("".concat(j,"://").concat(C,"/api/students/"));case 12:for(l in c=e.sent,console.log(o),o.newStudents){for(h in u="",d="",c)c[h].id===o.newStudents[l]&&(u=c[h].first_name+" "+c[h].last_name,d=c[h].student_key);(p=[])[0]=u,p[1]=null===d?"N/A":d,s.push(p)}return e.next=17,F(s,r,i);case 17:this.setState({buildingCSV:!1});case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"updateStartDate",value:function(e){this.setState({startDate:e.target.value})}},{key:"updateEndDate",value:function(e){this.setState({endDate:e.target.value})}},{key:"render",value:function(){var e=this.state.buildingCSV;return s.a.createElement("div",null,s.a.createElement("h3",null," Download New Student Report "),s.a.createElement("p",null,"Downloads a spreadsheet containing all students that were checked in for the first time between two dates"),s.a.createElement(le.a,{inline:!0,style:{paddingRight:"5px",paddingLeft:"5px"}},s.a.createElement(z.a,null,s.a.createElement(Q.a,null,"Start Date:")," ",s.a.createElement($.a,{onChange:this.updateStartDate,value:this.state.startDate,type:"date"}),"  ",s.a.createElement(Q.a,null,"End Date:")," ",s.a.createElement($.a,{onChange:this.updateEndDate,value:this.state.endDate,type:"date"}),"  ",s.a.createElement(G.a,{onClick:this.downloadCSV,disabled:e},e?"Downloading...":"Download"))))}}]),t}(s.a.Component),Ie=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={milestone:30,buildingCSV:!1,startDate:"",endDate:""},a.updateEndDate=a.updateEndDate.bind(Object(Y.a)(Object(Y.a)(a))),a.updateStartDate=a.updateStartDate.bind(Object(Y.a)(Object(Y.a)(a))),a.updateMilestone=a.updateMilestone.bind(Object(Y.a)(Object(Y.a)(a))),a.downloadCSV=a.downloadCSV.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"downloadCSV",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t,a,n,s,r,i,o,c,l,u,d,h,p,m;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state,a=t.startDate,n=t.endDate,s=t.milestone,""!==a&&""!==n){e.next=3;break}return e.abrupt("return");case 3:return this.setState({buildingCSV:!0}),r=[],i=["Student Name","Student Key"],o="Milestone_".concat(s,"_").concat(a,"-").concat(n),e.next=9,M("".concat(j,"://").concat(C,"/api/reports/milestones/?startdate=").concat(a,"&enddate=").concat(n,"&milestone=").concat(s));case 9:return c=e.sent,e.next=12,M("".concat(j,"://").concat(C,"/api/students/"));case 12:for(u in l=e.sent,c.milestoneStudents){for(p in d="",h="",l)l[p].id===c.milestoneStudents[u]&&(d=l[p].first_name+" "+l[p].last_name,h=l[p].student_key);(m=[])[0]=d,m[1]=null===h?"N/A":h,r.push(m)}return e.next=16,F(r,i,o);case 16:this.setState({buildingCSV:!1});case 17:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"updateStartDate",value:function(e){this.setState({startDate:e.target.value})}},{key:"updateEndDate",value:function(e){this.setState({endDate:e.target.value})}},{key:"updateMilestone",value:function(e){this.setState({milestone:e.target.value})}},{key:"render",value:function(){var e=this.state.buildingCSV;return s.a.createElement("div",null,s.a.createElement("h3",null," Download Attendance Milestones "),s.a.createElement("p",null,"Downloads a spreadsheet containing a list of students who reached a given attendance milestone between two dates."),s.a.createElement("p",null,"For instance, if the milestone was set to 30, the spreadsheet would list the students to attended the Key for their 30th time between two given dates"),s.a.createElement(le.a,{inline:!0,style:{paddingRight:"5px",paddingLeft:"5px"}},s.a.createElement(z.a,null,s.a.createElement(Q.a,null,"Milestone:")," ",s.a.createElement($.a,{onChange:this.updateMilestone,value:this.state.milestone,type:"number"}),"  ",s.a.createElement(Q.a,null,"Start Date:")," ",s.a.createElement($.a,{onChange:this.updateStartDate,value:this.state.startDate,type:"date"}),"  ",s.a.createElement(Q.a,null,"End Date:")," ",s.a.createElement($.a,{onChange:this.updateEndDate,value:this.state.endDate,type:"date"}),"  ",s.a.createElement(G.a,{onClick:this.downloadCSV,disabled:e},e?"Downloading...":"Download"))))}}]),t}(s.a.Component),Me=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={startDateStringWeek:"",endDateStringWeek:"",startDateStringYear:"",endDateStringYear:"",byHourJson:[],byHourJsonForDownload:[],byDayJson:[],byDayJsonForDownload:[],byDayInPastWeekJson:[],byDayInPastWeekForDownload:[],byDayHeatMap:[],dateOne:"",dateTwo:"",buildingCSV:!1,tab:1},a.downloadHourlyCSV=a.downloadHourlyCSV.bind(Object(Y.a)(Object(Y.a)(a))),a.downloadWeeklyCSV=a.downloadWeeklyCSV.bind(Object(Y.a)(Object(Y.a)(a))),a.downloadYearlyCSV=a.downloadYearlyCSV.bind(Object(Y.a)(Object(Y.a)(a))),a.updateDateOne=a.updateDateOne.bind(Object(Y.a)(Object(Y.a)(a))),a.updateDateTwo=a.updateDateTwo.bind(Object(Y.a)(Object(Y.a)(a))),a.downloadCSV=a.downloadCSV.bind(Object(Y.a)(Object(Y.a)(a))),a.handleTabSelect=a.handleTabSelect.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t,a,n,s,r,i,o,c,l,u;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=W(0),a=W(6),n=B(a),s=B(t),e.next=7,M("".concat(j,"://").concat(C,"/api/reports/byHourAttendance/?startdate=").concat(n,"&enddate=").concat(s));case 7:return r=e.sent,i=H(i=W(365)),o=B(i),c=L(t),l=B(c),e.next=15,M("".concat(j,"://").concat(C,"/api/reports/byDayAttendance/?startdate=").concat(o,"&enddate=").concat(l));case 15:return u=e.sent,e.next=18,this.formatDayData(u,o,l,a);case 18:return e.next=20,this.formatHourData(r,n,s);case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),console.log(e.t0);case 25:case"end":return e.stop()}},e,this,[[0,22]])}));return function(){return e.apply(this,arguments)}}()},{key:"handleTabSelect",value:function(e){this.setState({tab:e})}},{key:"updateDateOne",value:function(e){this.setState({dateOne:e.target.value})}},{key:"updateDateTwo",value:function(e){this.setState({dateTwo:e.target.value})}},{key:"downloadCSV",value:function(){var e=Object(w.a)(k.a.mark(function e(){return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==this.state.dateOne&&""!==this.state.dateTwo){e.next=2;break}return e.abrupt("return");case 2:return this.setState({buildingCSV:!0}),e.next=5,T(this.state.dateOne,this.state.dateTwo);case 5:this.setState({buildingCSV:!1});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"downloadHourlyCSV",value:function(){this.setState({buildingCSV:!0});var e="Reports_Hourly_Attendance_".concat(this.state.startDateStringWeek);e=(e=e.concat("_to_")).concat(this.state.endDateStringWeek),F(this.state.byHourJsonForDownload,["Date","Hour","# Engagements"],e),this.setState({buildingCSV:!1})}},{key:"downloadWeeklyCSV",value:function(){this.setState({buildingCSV:!0});var e="Reports_Daily_Attendance_".concat(this.state.startDateStringWeek);e=(e=e.concat("_to_")).concat(this.state.endDateStringWeek),F(this.state.byDayInPastWeekForDownload,["Date","# Engagements"],e),this.setState({buildingCSV:!1})}},{key:"downloadYearlyCSV",value:function(){this.setState({buildingCSV:!0});var e="Reports_Annual_Attendance_".concat(this.state.startDateStringYear);e=(e=e.concat("_to_")).concat(this.state.endDateStringYear),F(this.state.byDayJsonForDownload,["Date","# Engagements"],e),this.setState({buildingCSV:!1})}},{key:"sameDay",value:function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}},{key:"compareTime",value:function(e,t){return new Date(e)>new Date(t)}},{key:"formatDayData",value:function(e,t,a,n){var s,r=t,i=a,o=new Date(r.replace(/-/g,"/")),c=new Date(i.replace(/-/g,"/")),l=o,u=0,d=e;if(0===d.length){var h={date:r,daily_visits:0};d.push(h)}for(;!1===this.compareTime(l,c);){if(u>d.length-1&&(u=d.length-1),s=new Date(d[u].date.replace(/-/g,"/")),!1===this.sameDay(l,s)){var p={date:l.toISOString().slice(0,10),daily_visits:0};u!==d.length-1||this.compareTime(s,l)?d.splice(u,0,p):d.splice(u+1,0,p)}l.setDate(l.getDate()+1),u++}var m,f=[],b=[],v=n;v.setDate(v.getDate()-1);for(var g=W(0),y=0;y<d.length;y++)m=Object.values(d[y]),f.push(m),O=new Date(d[y].date.replace(/-/g,"/")),this.compareTime(O,v)&&0==this.compareTime(O,g)&&b.push(m);var k,w,S,O,E=[],C=[],j=[],_=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];for(y=0;y<d.length;y++)S=_[(O=new Date(d[y].date.replace(/-/g,"/"))).getDay()],w={x:Math.floor(y/7)+1,y:S,color:d[y].daily_visits},C.push(w),k={y:d[y].daily_visits,x:S},E.push(k),this.compareTime(O,v)&&0==this.compareTime(O,g)&&j.push(k);return this.setState(function(e,n){return{startDateStringYear:t,endDateStringYear:a,byDayJson:E,byDayInPastWeekJson:j,byDayJsonForDownload:f,byDayInPastWeekForDownload:b,byDayHeatMap:C}}),E}},{key:"formatHourData",value:function(e,t,a){var n,s,r=t,i=a,o=new Date(r.replace(/-/g,"/")),c=new Date(i.replace(/-/g,"/")),l=o,u=0,d=e,h=["14:00:00","15:00:00","16:00:00","17:00:00","18:00:00","19:00:00","20:00:00","21:00:00","22:00:00"];d=d.filter(function(e){return!0===h.includes(e.time)});var p=0,m=h[0];if(0===d.length){var f={date:r,time:h[0],count:0};d.push(f)}for(;!1===this.compareTime(l,c);){if(u>d.length-1&&(u=d.length-1),n=new Date(d[u].date.replace(/-/g,"/")),s=d[u].time,!1===this.sameDay(l,n)){var b={date:l.toISOString().slice(0,10),time:m,count:0};u!==d.length-1||this.compareTime(n,l)?d.splice(u,0,b):d.splice(u+1,0,b)}else if(m!==s){b={date:l.toISOString().slice(0,10),time:m,count:0};u!==d.length-1||s>m?d.splice(u,0,b):d.splice(u+1,0,b)}u++,m===h[h.length-1]&&(m="next day"),"next day"===m?(l.setDate(l.getDate()+1),m=h[0],p=0):m=h[++p]}for(var v,g=[],y=0;y<d.length;y++)v=Object.values(d[y]),g.push(v);var k,w,S=[],O=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];for(y=0;y<d.length;y++)k=O[new Date(d[y].date.replace(/-/g,"/")).getDay()],w={x:d[y].time.slice(0,5),y:k,color:d[y].count},S.push(w);return this.setState(function(e,n){return{startDateStringWeek:t,endDateStringWeek:a,byHourJson:S,byHourJsonForDownload:g}}),S}},{key:"render",value:function(){var e=this.state.buildingCSV;return V().indexOf("view_reports")<0?s.a.createElement(S.a,{to:"/attendance"}):s.a.createElement("div",{className:"content"},s.a.createElement(Ee.a,{activeKey:this.state.tab,onSelect:this.handleTabSelect},s.a.createElement(Ce.a,{key:1,eventKey:1,title:"Hourly Attendance"},s.a.createElement("h3",null," Hourly Attendance "),s.a.createElement(he.a,{style:{float:"right"}},s.a.createElement(G.a,{onClick:this.downloadHourlyCSV,disabled:e},e?"Downloading...":"Download Hourly")),s.a.createElement("p",null," Number of engagements per hour in ",s.a.createElement("b",null,this.state.startDateStringWeek)," to ",s.a.createElement("b",null,this.state.endDateStringWeek),"."),s.a.createElement("p",null,s.a.createElement("b",null,"Note:")," Data is displayed chronologically, with the top row representing the oldest day and the bottom row representing the current day."),s.a.createElement(ke,{data:this.state.byHourJson,heatMapType:"weekly"})),s.a.createElement(Ce.a,{key:2,eventKey:2,title:"Daily Attendance"},s.a.createElement("h3",null," Daily Attendance "),s.a.createElement(he.a,{style:{float:"right"}},s.a.createElement(G.a,{onClick:this.downloadWeeklyCSV,disabled:e},e?"Downloading...":"Download Daily")),s.a.createElement("p",null," Number of engagements per day in the past week from ",s.a.createElement("b",null,this.state.startDateStringWeek)," to ",s.a.createElement("b",null,this.state.endDateStringWeek),"."),s.a.createElement(_e,{data:this.state.byDayInPastWeekJson})),s.a.createElement(Ce.a,{key:3,eventKey:3,title:"Annual Attendance"},s.a.createElement("h3",null," Annual Daily Attendance "),s.a.createElement(he.a,{style:{float:"right"}},s.a.createElement(G.a,{onClick:this.downloadYearlyCSV,disabled:e},e?"Downloading...":"Download Annual")),s.a.createElement("p",null," Number of engagements per day in the past year from ",s.a.createElement("b",null,this.state.startDateStringYear)," to ",s.a.createElement("b",null,this.state.endDateStringYear),"."),s.a.createElement("p",null,s.a.createElement("b",null,"Note:")," Data is displayed chronologically, with the leftmost column representing the oldest week and the rightmost column representing the current week."),s.a.createElement(ke,{data:this.state.byDayHeatMap,heatMapType:"annual"})),s.a.createElement(Ce.a,{key:4,eventKey:4,title:"Multi-Date Attendance Sheet"},s.a.createElement("h3",null," Download Multi-Date Attendance Sheet "),s.a.createElement("p",null,"Combines and downloads attendance sheets from multiple dates"),s.a.createElement(le.a,{inline:!0,style:{paddingRight:"5px",paddingLeft:"5px"}},s.a.createElement(z.a,null,s.a.createElement(Q.a,null,"Start Date")," ",s.a.createElement($.a,{onChange:this.updateDateOne,value:this.state.dateOne,type:"date"}),"  ",s.a.createElement(Q.a,null,"End Date")," ",s.a.createElement($.a,{onChange:this.updateDateTwo,value:this.state.dateTwo,type:"date"}),"  ",s.a.createElement(G.a,{onClick:this.downloadCSV,disabled:e},e?"Downloading...":"Download")))),s.a.createElement(Ce.a,{key:5,eventKey:5,title:"Attendance By Program"},s.a.createElement(De,null)),s.a.createElement(Ce.a,{key:6,eventKey:6,title:"New Students"},s.a.createElement(xe,null)),s.a.createElement(Ce.a,{key:7,eventKey:7,title:"Attendance Milestones"},s.a.createElement(Ie,null))))}}]),t}(n.Component),Ne=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleChange=function(e){var t=e.target.name,n=e.target.value;a.setState(function(e){var a=Object(ae.a)({},e);return a[t]=n,a})},a.handleActiveCheckbox=function(e){a.setState({is_active:!a.state.is_active})},a.state={username:"",first_name:"",last_name:"",password:"",confirmPassword:"",is_active:!0,error:!1,backendError:!1,errorMsg:"",radioOptions:[],show:!1,selectedOption:""},a.cancel=a.cancel.bind(Object(Y.a)(Object(Y.a)(a))),a.submit=a.submit.bind(Object(Y.a)(Object(Y.a)(a))),a.handleChange=a.handleChange.bind(Object(Y.a)(Object(Y.a)(a))),a.validateInput=a.validateInput.bind(Object(Y.a)(Object(Y.a)(a))),a.handleActiveCheckbox=a.handleActiveCheckbox.bind(Object(Y.a)(Object(Y.a)(a))),a.createRadioOptions=a.createRadioOptions.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(){if(this.props.show!==this.state.show){var e=[],t=Object.keys(this.props.role_ids);for(var a in t)e.push({label:t[a],checked:!1});this.setState({radioOptions:e,show:this.props.show})}}},{key:"validateInput",value:function(){var e=this.state,t=e.username,a=e.password,n=e.confirmPassword;return t.length>0&&a.length>0&&a===n&&/^[a-z0-9.@+\-_]+$/i.test(t)&&this.state.selectedOption?"success":0===t.length&&0===a.length&&0===n.length?null:"error"}},{key:"cancel",value:function(){this.setState({username:"",first_name:"",last_name:"",password:"",confirmPassword:"",selectedOption:"",is_active:!0,error:!1,backendError:!1}),this.props.onSubmit()}},{key:"submit",value:function(){var e=this;if(e.setState({backendError:!1}),"success"===e.validateInput()){e.setState({error:!1});var t=[];t.push(e.props.role_ids[e.state.selectedOption]);var a={username:e.state.username,password:e.state.password,first_name:e.state.first_name,last_name:e.state.last_name,groups:t,is_active:e.state.is_active};_("".concat(j,"://").concat(C,"/api/users/"),a).then(function(t){"error"in t?t.response.then(function(t){e.setState({backendError:!0,errorMsg:t.error})}):(e.setState({username:"",first_name:"",last_name:"",password:"",confirmPassword:"",selectedOption:"",is_active:!0,error:!1,errorMsg:"",backendError:!1}),e.props.onSubmit(t))})}else e.setState({error:!0})}},{key:"toggleRadioOptions",value:function(e){var t=this.state.radioOptions,a="";if(!t[e].checked)for(var n in a=t[e].label,t)n!==e&&(t[n].checked=!1);t[e].checked=!t[e].checked,this.setState({selectedOption:a,radioOptions:t})}},{key:"createRadioOptions",value:function(){var e=this;return this.state.radioOptions.map(function(t,a){return s.a.createElement("div",{key:a},s.a.createElement("label",null,s.a.createElement("input",{type:"radio",name:"userRoles",value:t.label,checked:t.checked,onChange:e.toggleRadioOptions.bind(e,a),className:"form-check-input"}),t.label))})}},{key:"render",value:function(){var e="Server error. Please try again.";return""!==this.state.errorMsg&&null!==this.state.errorMsg&&void 0!==this.state.errorMsg&&(e=this.state.errorMsg),s.a.createElement(oe.a,{show:this.props.show},s.a.createElement(oe.a.Header,null,s.a.createElement(oe.a.Title,null,"Create New User")),s.a.createElement(oe.a.Body,null,s.a.createElement("form",null,s.a.createElement(z.a,{validationState:this.validateInput()},s.a.createElement(Q.a,null,"Username"),s.a.createElement($.a,{type:"text",name:"username",value:this.state.username,placeholder:"Username",onChange:this.handleChange}),s.a.createElement("br",null),s.a.createElement(Q.a,null,"First Name"),s.a.createElement($.a,{type:"text",name:"first_name",value:this.state.first_name,placeholder:"First Name",onChange:this.handleChange}),s.a.createElement("br",null),s.a.createElement(Q.a,null,"Last Name"),s.a.createElement($.a,{type:"text",name:"last_name",value:this.state.last_name,placeholder:"Last Name",onChange:this.handleChange}),s.a.createElement("br",null),s.a.createElement(Q.a,null,"Password"),s.a.createElement($.a,{type:"password",name:"password",value:this.state.password,placeholder:"Password",onChange:this.handleChange}),s.a.createElement("br",null),s.a.createElement(Q.a,null,"Confirm Password"),s.a.createElement($.a,{type:"password",name:"confirmPassword",value:this.state.confirmPassword||"",placeholder:"Confirm Password",onChange:this.handleChange}),s.a.createElement("br",null),s.a.createElement(Q.a,null,"Active"),s.a.createElement($.a,{type:"checkbox",checked:this.state.is_active,value:this.state.is_active,onChange:this.handleActiveCheckbox}),s.a.createElement(Q.a,null,"User Roles"),this.createRadioOptions(),s.a.createElement($.a.Feedback,null)))),s.a.createElement(oe.a.Footer,null,this.state.error&&s.a.createElement(X.a,{bsStyle:"danger"},"Invalid input. Please check your fields and try again."),this.state.backendError&&s.a.createElement(X.a,{bsStyle:"danger"},e),s.a.createElement(G.a,{onClick:this.cancel},"Cancel"),s.a.createElement(G.a,{onClick:this.submit,bsStyle:"primary"},"Create")))}}]),t}(s.a.Component),Ae=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleChange=function(e){var t=e.target.name,n=e.target.value;a.setState(function(e){var a=Object(ae.a)({},e);return a[t]=n,a})},a.handleActiveCheckbox=function(e){a.setState(function(e){var t=Object(ae.a)({},e);return t.is_active=!a.state.is_active,t})},a.handlePasswordButton=function(e){a.setState({editPassword:!a.state.editPassword,password:"",confirmPassword:""})},a.state={row:{},show:!1,radioOptions:[],selectedOption:"",first_name:"",last_name:"",is_active:!0,password:"",confirmPassword:"",editPassword:!1,error:!1,backendError:!1,errorMsg:""},a.delete=a.delete.bind(Object(Y.a)(Object(Y.a)(a))),a.cancel=a.cancel.bind(Object(Y.a)(Object(Y.a)(a))),a.submit=a.submit.bind(Object(Y.a)(Object(Y.a)(a))),a.handleChange=a.handleChange.bind(Object(Y.a)(Object(Y.a)(a))),a.handlePasswordButton=a.handlePasswordButton.bind(Object(Y.a)(Object(Y.a)(a))),a.handleActiveCheckbox=a.handleActiveCheckbox.bind(Object(Y.a)(Object(Y.a)(a))),a.validateInput=a.validateInput.bind(Object(Y.a)(Object(Y.a)(a))),a.createRadioOptions=a.createRadioOptions.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"validateInput",value:function(){var e=this.state,t=e.password,a=e.confirmPassword;return e.editPassword?0===t.length||t!==a?"error":"success":null}},{key:"componentDidUpdate",value:function(){if(this.props.row!==this.state.row&&this.setState({row:this.props.row}),this.props.show!==this.state.show){var e=[],t=Object.keys(this.props.row.role_ids),a=this.props.row.role_ids,n="";for(var s in t){var r=t[s],i=this.props.row.groups.indexOf(a[r])>-1;i&&(n=r),e.push({label:r,checked:i})}this.setState({radioOptions:e,selectedOption:n,show:this.props.show,first_name:this.props.row.first_name,last_name:this.props.row.last_name,is_active:this.props.row.is_active})}}},{key:"cancel",value:function(){this.setState({row:this.props.row,error:!1,backendError:!1,password:"",confirmPassword:"",editPassword:!1,errorMsg:!1}),this.props.onSubmit()}},{key:"delete",value:function(){var e=this;N("".concat(j,"://").concat(C,"/api/users/?id=").concat(e.state.row.id)).then(function(t){"error"in t?t.response.then(function(t){e.setState({backendError:!0,errorMsg:t.error})}):(e.setState({backendError:!1,errorMsg:""}),e.props.onDelete(e.state.row.id))})}},{key:"submit",value:function(){var e=this;if(this.setState({backendError:!1}),"error"!==e.validateInput()){this.setState({error:!1});var t={id:e.state.row.id,first_name:e.state.first_name,last_name:e.state.last_name,is_active:e.state.is_active},a=[];a.push(e.props.row.role_ids[e.state.selectedOption]),t.groups=a,""!==e.state.password&&(t.password=e.state.password),x("".concat(j,"://").concat(C,"/api/users/"),t).then(function(t){"error"in t?t.response.then(function(t){e.setState({backendError:!0,errorMsg:t.error})}):(e.setState({password:"",confirmPassword:"",editPassword:!1,backendError:!1,errorMsg:""}),e.props.onSubmit(t))})}else this.setState({error:!0})}},{key:"toggleRadioOptions",value:function(e){var t=this.state,a=t.radioOptions,n=t.selectedOption;if(!a[e].checked)for(var s in n=a[e].label,a)s!==e&&(a[s].checked=!1);a[e].checked=!a[e].checked,this.setState({selectedOption:n,radioOptions:a})}},{key:"createRadioOptions",value:function(){var e=this;return this.state.radioOptions.map(function(t,a){return s.a.createElement("div",{key:a},s.a.createElement("label",null,s.a.createElement("input",{type:"radio",name:"userRoles",value:t.label,checked:t.checked,onChange:e.toggleRadioOptions.bind(e,a),className:"form-check-input"}),t.label))})}},{key:"render",value:function(){var e,t=this;e=this.state.editPassword?s.a.createElement("div",null,s.a.createElement(Q.a,null,"Password"),s.a.createElement($.a,{type:"password",name:"password",value:this.state.password,placeholder:"Password",onChange:this.handleChange}),s.a.createElement("br",null),s.a.createElement(Q.a,null,"Confirm Password"),s.a.createElement($.a,{type:"password",name:"confirmPassword",value:this.state.confirmPassword,placeholder:"Confirm Password",onChange:this.handleChange}),s.a.createElement("br",null),s.a.createElement(G.a,{bsStyle:"warning",onClick:this.handlePasswordButton},"Discard Password Changes"),s.a.createElement("br",null)):s.a.createElement(G.a,{bsStyle:"link",onClick:this.handlePasswordButton},"Change Password");var a="Server error. Please try again.";return""!==this.state.errorMsg&&null!==this.state.errorMsg&&void 0!==this.state.errorMsg&&(a=this.state.errorMsg),s.a.createElement(oe.a,{show:this.props.show},s.a.createElement(oe.a.Header,null,s.a.createElement(oe.a.Title,null,"Edit User")),s.a.createElement(oe.a.Body,null,s.a.createElement("form",null,s.a.createElement(z.a,{validationState:this.validateInput()},s.a.createElement(Q.a,null,"Username"),s.a.createElement("p",null,this.state.row.username),s.a.createElement("br",null),s.a.createElement(Q.a,null,"First Name"),s.a.createElement($.a,{type:"text",name:"first_name",value:this.state.first_name||"",placeholder:"First Name",onChange:this.handleChange}),s.a.createElement("br",null),s.a.createElement(Q.a,null,"Last Name"),s.a.createElement($.a,{type:"text",name:"last_name",value:this.state.last_name||"",placeholder:"Last Name",onChange:this.handleChange}),s.a.createElement("br",null),s.a.createElement(Q.a,null,"Active"),s.a.createElement($.a,{type:"checkbox",checked:this.state.is_active||!1,value:this.state.is_active,onChange:this.handleActiveCheckbox}),s.a.createElement("br",null),s.a.createElement(Q.a,null,"User Role"),this.createRadioOptions(),e,s.a.createElement($.a.Feedback,null)))),s.a.createElement(oe.a.Footer,null,this.state.error&&s.a.createElement(X.a,{bsStyle:"danger"},"Invalid password. Please make sure they match and try again."),this.state.backendError&&s.a.createElement(X.a,{bsStyle:"danger"},a),s.a.createElement(G.a,{onClick:this.cancel},"Cancel"),s.a.createElement(G.a,{onClick:this.submit,bsStyle:"primary"},"Save"),s.a.createElement(G.a,{onClick:function(){window.confirm("Are you sure you wish to delete this user?")&&t.delete()},bsStyle:"danger"},"Delete")))}}]),t}(s.a.Component),Pe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={row:{},showUserModal:!1},a.openModal=a.openModal.bind(Object(Y.a)(Object(Y.a)(a))),a.closeModal=a.closeModal.bind(Object(Y.a)(Object(Y.a)(a))),a.closeModalDelete=a.closeModalDelete.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({row:this.props.row})}},{key:"openModal",value:function(){this.setState({showUserModal:!0})}},{key:"closeModal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==t){e.props.CustomFunction(t)}this.setState({showUserModal:!1})}},{key:"closeModalDelete",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.setState({showUserModal:!1}),null!==t){e.props.CustomFunction(null,t)}}},{key:"componentDidUpdate",value:function(){this.props.row.id!==this.state.row.id&&this.setState({row:this.props.row})}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(Ae,{show:this.state.showUserModal,row:this.props.row,onDelete:this.closeModalDelete,onSubmit:this.closeModal}),s.a.createElement(G.a,{bsStyle:"link",onClick:this.openModal},"Edit User"))}}]),t}(s.a.Component),Te=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={row:{}},a.handleClick=a.handleClick.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({row:this.props.row})}},{key:"componentDidUpdate",value:function(){this.props.row.id!==this.state.row.id&&this.setState({row:this.props.row})}},{key:"handleClick",value:function(){var e=this;e.props.CustomFunction(e.state.row.id,e.state.row.username)}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(G.a,{bsStyle:"link",onClick:this.handleClick},"View History"))}}]),t}(s.a.Component),Ue=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={history:[],username:""},a.closeHistoryView=a.closeHistoryView.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({history:this.props.history,username:this.props.username})}},{key:"closeHistoryView",value:function(){this.props.closeHistoryView()}},{key:"render",value:function(){var e=this.state.history.map(function(e){return{datetime:e.datetime,action:e.action,values:e.values}}).sort(function(e,t){return t.datetime.localeCompare(e.datetime)});return s.a.createElement("div",{className:"content"},s.a.createElement("h1",null,"User History: ",this.state.username),s.a.createElement("br",null),s.a.createElement(he.a,{style:{float:"left"}},s.a.createElement(G.a,{bsStyle:"link",onClick:this.closeHistoryView},"Return to User Management")),s.a.createElement("br",null),s.a.createElement(te.a,{rows:e,columns:[{accessor:"datetime",label:"Date/Time",priorityLevel:1,position:1,minWidth:100,sortable:!0},{accessor:"action",label:"Action",priorityLevel:2,position:2,minWidth:100,sortable:!0},{accessor:"values",label:"Values",priorityLevel:3,position:3,minWidth:100,sortable:!1}],column:"datetime",direction:"descending",showPagination:!0}))}}]),t}(s.a.Component),Fe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={showUserModal:!1,users:[],showingUsers:[],role_ids:{},role_names:{},suggestionsArray:[],showingAllUsers:!0,selectedUserHistory:[],selectedUsername:"",historyView:!1},a.openModal=a.openModal.bind(Object(Y.a)(Object(Y.a)(a))),a.closeModal=a.closeModal.bind(Object(Y.a)(Object(Y.a)(a))),a.updateRow=a.updateRow.bind(Object(Y.a)(Object(Y.a)(a))),a.getFormattedTime=a.getFormattedTime.bind(Object(Y.a)(Object(Y.a)(a))),a.handler=a.handler.bind(Object(Y.a)(Object(Y.a)(a))),a.showAllUsers=a.showAllUsers.bind(Object(Y.a)(Object(Y.a)(a))),a.getUserHistory=a.getUserHistory.bind(Object(Y.a)(Object(Y.a)(a))),a.closeHistoryView=a.closeHistoryView.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t,a,n,s,r,i;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M("".concat(j,"://").concat(C,"/api/users/"));case 3:return t=e.sent,a=this.makeSuggestionsArray(t),e.next=7,M("".concat(j,"://").concat(C,"/api/groups/"));case 7:for(i in n=e.sent,s={},r={},n)s[n[i].name]=n[i].id,r[n[i].id]=n[i].name;this.setState({showingUsers:t,users:t,role_ids:s,role_names:r,suggestionsArray:a}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.log(e.t0);case 17:case"end":return e.stop()}},e,this,[[0,14]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t,a,n,s,r;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.refreshRoles){e.next=12;break}return e.next=3,M("".concat(j,"://").concat(C,"/api/users/"));case 3:return t=e.sent,e.next=6,M("".concat(j,"://").concat(C,"/api/groups/"));case 6:for(r in a=e.sent,n={},s={},a)n[a[r].name]=a[r].id,s[a[r].id]=a[r].name;this.setState({showingUsers:t,users:t,role_ids:n,role_names:s,showAllUsers:!0}),this.props.toggleRefreshRoles(!1);case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"makeSuggestionsArray",value:function(e){var t,a,n,s=[];for(var r in e)e[r].last_name.includes(" ")?(t=(n=e[r].last_name.split(" "))[0],a=n[1]):(t=e[r].last_name,a=""),s.push({firstName:e[r].first_name,lastName1:t,lastName2:a,username:e[r].username,id:e[r].id});return s}},{key:"handler",value:function(e,t){var a=[];null!==t&&a.push(this.state.users.find(function(e){return e.id===parseInt(t)})),this.setState({showingUsers:a,showingAllUsers:!1})}},{key:"showAllUsers",value:function(){var e=this.state.users;this.setState({showingUsers:e,showingAllUsers:!0})}},{key:"openModal",value:function(){this.setState({showUserModal:!0})}},{key:"closeModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.state,a=t.suggestionsArray,n=t.users,s=[];if(null!==e){var r,i,o={id:e.id,username:e.username,first_name:e.first_name,last_name:e.last_name,groups:e.groups,last_login:e.last_login,is_active:e.is_active};if(e.last_name.includes(" ")){var c=e.last_name.split(" ");r=c[0],i=c[1]}else r=e.last_name,i="";a.push({firstName:e.first_name,lastName1:r,lastName2:i,username:e.username,id:e.id}),n.push(o),s.push(o),this.setState({showUserModal:!1,users:n,showingUsers:s,showingAllUsers:!1,suggestionsArray:a})}else this.setState({showUserModal:!1})}},{key:"checkmark",value:function(e){return e?"&#10003;":""}},{key:"getFormattedTime",value:function(e){if(null===e||0===e.length)return"";var t=e.split("T"),a=t[0],n=t[1].split(".")[0].split(":"),s=parseInt(n[0]),r=s>=12?"PM":"AM";return a+" "+(s=0===(s%=12)?12:s)+":"+n[1]+" "+r}},{key:"getUserRoleNames",value:function(e){var t=[];for(var a in e)t.push(this.state.role_names[e[a]]);return t.join(", ")}},{key:"updateRow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=this.state,n=a.users,s=a.suggestionsArray,r=[],i=!1;if(null!==t)n=n.filter(function(e){return e.id!==t}),s=s.filter(function(e){return e.id!==t}),i=!0,r=n;else{n=n.filter(function(t){return t.id!==e.id}),s=s.filter(function(t){return t.id!==e.id});var o,c,l={id:e.id,username:e.username,first_name:e.first_name,last_name:e.last_name,groups:e.groups,last_login:e.last_login,is_active:e.is_active};if(e.last_name.includes(" ")){var u=e.last_name.split(" ");o=u[0],c=u[1]}else o=e.last_name,c="";s.push({firstName:e.first_name,lastName1:o,lastName2:c,username:e.username,id:e.id}),n.push(l),r.push(l)}this.setState({users:n,showingUsers:r,showingAllUsers:i,suggestionsArray:s})}},{key:"getUserHistory",value:function(e,t){var a=this;M("".concat(j,"://").concat(C,"/api/history/?user_id=").concat(e)).then(function(e){"error"in e?alert("Error: Unknown server error getting user history."):a.setState({selectedUserHistory:e,historyView:!0,selectedUsername:t})})}},{key:"closeHistoryView",value:function(){this.setState({historyView:!1})}},{key:"render",value:function(){var e,t=this,a=this.state.showingUsers.map(function(e){return{username:e.username,first_name:e.first_name,last_name:e.last_name,name:e.first_name+" "+e.last_name,roles:t.getUserRoleNames(e.groups),groups:e.groups,lastLogin:t.getFormattedTime(e.last_login),isActive:t.checkmark(e.is_active),id:e.id,is_active:e.is_active,role_ids:t.state.role_ids}}).sort(function(e,t){return e.username.localeCompare(t.username)}),n=[{accessor:"name",label:"Name",priorityLevel:1,position:1,minWidth:100,sortable:!0},{accessor:"username",label:"Username",priorityLevel:2,position:2,minWidth:100,sortable:!0},{accessor:"lastLogin",label:"Last Login",priorityLevel:3,position:3,minWidth:100,sortable:!0},{accessor:"roles",label:"User Roles",priorityLevel:4,position:4,sortable:!0,minWidth:30},{accessor:"isActive",label:"Active",priorityLevel:5,position:5,minWidth:20,sortable:!0},{accessor:"edit",label:"",priorityLevel:6,position:6,CustomComponent:Pe,minWidth:50,sortable:!1},{accessor:"history",label:"",priorityLevel:7,position:7,CustomComponent:Te,minWidth:50,sortable:!1}],r={edit:this.updateRow,history:this.getUserHistory};return this.state.historyView?s.a.createElement(Ue,{closeHistoryView:this.closeHistoryView,history:this.state.selectedUserHistory,username:this.state.selectedUsername}):(e=V().indexOf("add_user")>=0?s.a.createElement(he.a,{style:{float:"right"}},s.a.createElement(G.a,{className:this.state.showingAllUsers?"hidden":"",bsStyle:"link",onClick:this.showAllUsers},"Show All Users"),s.a.createElement(G.a,{onClick:this.openModal},"New User")):s.a.createElement(he.a,{style:{float:"right"}},s.a.createElement(G.a,{className:this.state.showingAllUsers?"hidden":"",bsStyle:"link",onClick:this.showAllUsers},"Show All Users")),s.a.createElement("div",{className:"content"},s.a.createElement(Ne,{role_ids:this.state.role_ids,show:this.state.showUserModal,onSubmit:this.closeModal}),s.a.createElement("h1",null,"User Management"),s.a.createElement("br",null),e,s.a.createElement(de,{hasUsername:!0,suggestions:this.state.suggestionsArray,handler:this.handler}),s.a.createElement("br",null),s.a.createElement(te.a,{rows:a,columns:n,column:"username",direction:"descending",showPagination:!0,callbacks:r})))}}]),t}(s.a.Component),Re=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleChange=function(e){var t=e.target.name,n=e.target.value;a.setState(function(e){var a=Object(ae.a)({},e);return a[t]=n,a})},a.state={show:!1,name:"",permission_ids:{},checkboxes:[],error:!1,backendError:!1,errorMsg:""},a.cancel=a.cancel.bind(Object(Y.a)(Object(Y.a)(a))),a.submit=a.submit.bind(Object(Y.a)(Object(Y.a)(a))),a.handleChange=a.handleChange.bind(Object(Y.a)(Object(Y.a)(a))),a.createCheckboxes=a.createCheckboxes.bind(Object(Y.a)(Object(Y.a)(a))),a.validateInput=a.validateInput.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(){if(this.props.show!==this.state.show){var e=[],t=this.props.permission_ids,a=Object.keys(t);for(var n in a){var s=a[n],r=s;r.includes("group")?r=r.replace("group","user role"):r.includes("activity")?r=r.replace("activity","programming"):r.includes("attendance items")?r=r.replace("attendance items","attendance entries"):r.includes("student column")?r=r.replace("student column","student field"):r.includes("city span students")&&(r=r.replace("city span students","student keys")),e.push({label:s,checked:!1,displayName:r})}this.setState({permission_ids:this.props.permission_ids,checkboxes:e,show:this.props.show})}}},{key:"cancel",value:function(){this.setState({name:"",error:!1,backendError:!1,errorMsg:""}),this.props.onSubmit()}},{key:"submit",value:function(){var e=this;if(e.setState({backendError:!1}),"error"!==e.validateInput()){e.setState({error:!1});var t={name:e.state.name},a=[],n=e.state.checkboxes;for(var s in n)n[s].checked&&a.push(e.state.permission_ids[n[s].label]);a.length<1?e.setState({error:!0}):(t.permissions=a,_("".concat(j,"://").concat(C,"/api/groups/"),t).then(function(t){"error"in t?t.response.then(function(t){e.setState({backendError:!0,errorMsg:t.error})}):(e.setState({name:""}),e.props.onSubmit(t))}))}else e.setState({error:!0})}},{key:"toggleCheckbox",value:function(e){var t=this.state.checkboxes;t[e].checked=!t[e].checked,this.setState({checkboxes:t})}},{key:"createCheckboxes",value:function(){var e=this;return this.state.checkboxes.map(function(t,a){return s.a.createElement("div",{key:a},s.a.createElement("label",null,s.a.createElement("input",{type:"checkbox",checked:t.checked,onChange:e.toggleCheckbox.bind(e,a)}),t.displayName))})}},{key:"validateInput",value:function(){var e=this.state.name;return e.length>0&&/^[a-z0-9 .@+\-_]+$/i.test(e)?"success":0===e.length?null:"error"}},{key:"render",value:function(){var e="Server error. Please try again.";return""!==this.state.errorMsg&&null!==this.state.errorMsg&&void 0!==this.state.errorMsg&&(e=this.state.errorMsg),s.a.createElement(oe.a,{show:this.props.show},s.a.createElement(oe.a.Header,null,s.a.createElement(oe.a.Title,null,"Create New User Role")),s.a.createElement(oe.a.Body,null,s.a.createElement("form",null,s.a.createElement(z.a,{validationState:this.validateInput()},s.a.createElement(Q.a,null,"Role Name"),s.a.createElement($.a,{type:"text",name:"name",value:this.state.name,placeholder:"Role Name",onChange:this.handleChange}),s.a.createElement("br",null),this.createCheckboxes(),s.a.createElement($.a.Feedback,null)))),s.a.createElement(oe.a.Footer,null,this.state.error&&s.a.createElement(X.a,{bsStyle:"danger"},"Invalid input. Please check your fields and try again."),this.state.backendError&&s.a.createElement(X.a,{bsStyle:"danger"},e),s.a.createElement(G.a,{onClick:this.cancel},"Cancel"),s.a.createElement(G.a,{onClick:this.submit,bsStyle:"primary"},"Create")))}}]),t}(s.a.Component),Ve=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={show:!1,row:{},permission_ids:{},checkboxes:[],errorMsg:"",error:!1},a.delete=a.delete.bind(Object(Y.a)(Object(Y.a)(a))),a.cancel=a.cancel.bind(Object(Y.a)(Object(Y.a)(a))),a.submit=a.submit.bind(Object(Y.a)(Object(Y.a)(a))),a.createCheckboxes=a.createCheckboxes.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(){if(this.props.row!==this.state.row&&this.setState({row:this.props.row}),this.props.show!==this.state.show){var e=[],t=Object.keys(this.props.row.permission_ids),a=this.props.row.permission_ids;for(var n in t){var s=t[n],r=s;r.includes("group")?r=r.replace("group","user role"):r.includes("activity")?r=r.replace("activity","programming"):r.includes("attendance items")?r=r.replace("attendance items","attendance entries"):r.includes("student column")?r=r.replace("student column","student field"):r.includes("city span students")&&(r=r.replace("city span students","student keys"));var i=this.props.row.permissions.indexOf(a[s])>-1;e.push({label:s,checked:i,displayName:r})}this.setState({checkboxes:e,permission_ids:this.props.row.permission_ids,show:this.props.show})}}},{key:"delete",value:function(){var e=this;N("".concat(j,"://").concat(C,"/api/groups/?id=").concat(e.state.row.id)).then(function(t){"error"in t?t.response.then(function(t){e.setState({error:!0,errorMsg:t.error})}):(e.setState({error:!1,errorMsg:""}),e.props.onDelete(e.state.row.id))})}},{key:"cancel",value:function(){this.setState({row:this.props.row,error:!1,errorMsg:""}),this.props.onSubmit()}},{key:"submit",value:function(){var e=this,t={name:e.state.row.name,id:e.state.row.id},a=[],n=e.state.checkboxes;for(var s in n)n[s].checked&&a.push(e.state.permission_ids[n[s].label]);t.permissions=a,x("".concat(j,"://").concat(C,"/api/groups/"),t).then(function(t){"error"in t?t.response.then(function(t){e.setState({error:!0,errorMsg:t.error})}):(e.setState({error:!1,errorMsg:""}),e.props.onSubmit(t))})}},{key:"toggleCheckbox",value:function(e){var t=this.state.checkboxes;t[e].checked=!t[e].checked,this.setState({checkboxes:t})}},{key:"createCheckboxes",value:function(){var e=this;return this.state.checkboxes.map(function(t,a){return s.a.createElement("div",{key:a},s.a.createElement("label",null,s.a.createElement("input",{type:"checkbox",checked:t.checked,disabled:"Admin"===e.state.row.name,onChange:e.toggleCheckbox.bind(e,a)}),t.displayName))})}},{key:"render",value:function(){var e=this,t="Server error. Please try again.";return""!==this.state.errorMsg&&null!==this.state.errorMsg&&void 0!==this.state.errorMsg&&(t=this.state.errorMsg),s.a.createElement(oe.a,{show:this.props.show},s.a.createElement(oe.a.Header,null,s.a.createElement(oe.a.Title,null,"Edit User Role")),s.a.createElement(oe.a.Body,null,s.a.createElement("form",null,s.a.createElement(z.a,null,s.a.createElement(Q.a,null,"User Role"),s.a.createElement("p",null,this.state.row.name),this.createCheckboxes(),s.a.createElement($.a.Feedback,null)))),s.a.createElement(oe.a.Footer,null,this.state.error&&s.a.createElement(X.a,{bsStyle:"danger"},t),s.a.createElement(G.a,{onClick:this.cancel},"Cancel"),s.a.createElement(G.a,{onClick:this.submit,bsStyle:"primary"},"Save"),s.a.createElement(G.a,{onClick:function(){window.confirm("Are you sure you wish to delete this role? All users with this role will be set to inactive.")&&e.delete()},bsStyle:"danger",disabled:"Admin"===this.state.row.name},"Delete")))}}]),t}(s.a.Component),We=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={row:{},showModal:!1},a.openModal=a.openModal.bind(Object(Y.a)(Object(Y.a)(a))),a.closeModal=a.closeModal.bind(Object(Y.a)(Object(Y.a)(a))),a.closeModalDelete=a.closeModalDelete.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({row:this.props.row})}},{key:"openModal",value:function(){this.setState({showModal:!0})}},{key:"closeModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.state.row;null!==e&&(this.props.row.permissions=e.permissions,t.permissions=e.permissions),this.setState({showModal:!1,row:t})}},{key:"closeModalDelete",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.setState({showModal:!1}),null!==t){e.props.CustomFunction(t)}}},{key:"componentDidUpdate",value:function(){this.props.row.id!==this.state.row.id&&this.setState({row:this.props.row})}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(Ve,{show:this.state.showModal,row:this.props.row,onDelete:this.closeModalDelete,onSubmit:this.closeModal}),s.a.createElement(G.a,{bsStyle:"link",onClick:this.openModal},"Edit User Role"))}}]),t}(s.a.Component),He=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={showModal:!1,roles:[],permissions_list:{},permission_ids:{}},a.openModal=a.openModal.bind(Object(Y.a)(Object(Y.a)(a))),a.closeModal=a.closeModal.bind(Object(Y.a)(Object(Y.a)(a))),a.deleteRole=a.deleteRole.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t,a,n,s;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M("".concat(j,"://").concat(C,"/api/groups/"));case 3:return t=e.sent,e.next=6,M("".concat(j,"://").concat(C,"/api/permissions/"));case 6:for(s in a=e.sent,n={},a)n[a[s].name]=a[s].id;this.setState({roles:t,permissions_list:a,permission_ids:n}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0);case 15:case"end":return e.stop()}},e,this,[[0,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"openModal",value:function(){this.setState({showModal:!0})}},{key:"closeModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.state.roles;null!==e&&(t.push({id:e.id,name:e.name,permissions:e.permissions}),this.props.toggleRefreshRoles(!0)),this.setState({showModal:!1,roles:t})}},{key:"deleteRole",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.state.roles;null!==e&&(t=t.filter(function(t){return t.id!==e}),this.props.toggleRefreshRoles(!0)),this.setState({roles:t})}},{key:"render",value:function(){var e=this,t=this.state.roles.map(function(t){return{name:t.name,permissions:t.permissions,id:t.id,permission_ids:e.state.permission_ids}}).sort(function(e,t){return e.name.localeCompare(t.name)}),a=[{accessor:"name",label:"Role",priorityLevel:1,position:1,minWidth:50,sortable:!0},{accessor:"edit",label:"",priorityLevel:2,position:5,CustomComponent:We,minWidth:50,sortable:!1}],n={edit:this.deleteRole};return s.a.createElement("div",{className:"content"},s.a.createElement("h1",null,"User Roles"),s.a.createElement(he.a,{style:{float:"right"}},s.a.createElement(G.a,{onClick:this.openModal},"New User Role")),s.a.createElement(Re,{permission_ids:this.state.permission_ids,show:this.state.showModal,onSubmit:this.closeModal}),s.a.createElement(te.a,{rows:t,columns:a,column:"name",direction:"descending",showPagination:!0,callbacks:n}))}}]),t}(s.a.Component),Le=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={oldID:0,student:{},suggestions:[],searchArray:[],match:""},a.onCancel=a.onCancel.bind(Object(Y.a)(Object(Y.a)(a))),a.onSubmit=a.onSubmit.bind(Object(Y.a)(Object(Y.a)(a))),a.setMatch=a.setMatch.bind(Object(Y.a)(Object(Y.a)(a))),a.buildSuggestionsArray=a.buildSuggestionsArray.bind(Object(Y.a)(Object(Y.a)(a))),a.setMatchFromSearch=a.setMatchFromSearch.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({oldID:this.props.studentID})}},{key:"componentDidUpdate",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t,a,n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.studentID===this.state.oldID||-1===this.props.studentID){e.next=9;break}return e.next=3,M("".concat(j,"://").concat(C,"/api/students/?id=").concat(this.props.studentID));case 3:return t=e.sent,e.next=6,M("".concat(j,"://").concat(C,"/api/suggestions/student/?id=").concat(this.props.studentID));case 6:a=e.sent,n=this.buildSuggestionsArray(),this.setState({student:t,suggestions:a,searchArray:n,oldID:this.props.studentID});case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"buildSuggestionsArray",value:function(){var e=[],t=this.props.citySpanStudents;for(var a in this.props.citySpanStudents)e.push({firstName:t[a].first_name,lastName1:t[a].last_name,lastName2:"",id:t[a].student_key});return e}},{key:"setMatch",value:function(e){this.setState({match:e})}},{key:"setMatchFromSearch",value:function(e,t){this.setState({match:t})}},{key:"onCancel",value:function(){this.setState({student:{},match:"",suggestions:[]}),this.props.onClose()}},{key:"onSubmit",value:function(){x("".concat(j,"://").concat(C,"/api/students/"),{student_key:this.state.match,id:this.props.studentID}),this.setState({student:{},match:"",suggestions:[]}),this.props.onClose(this.props.studentID)}},{key:"render",value:function(){var e=this;return s.a.createElement(oe.a,{show:this.props.show},s.a.createElement(oe.a.Header,null,s.a.createElement(oe.a.Title,null,"Find Student Key Match: ",void 0!==this.state.student.first_name?this.state.student.first_name+" "+this.state.student.last_name:"")),s.a.createElement(oe.a.Body,null,s.a.createElement("h4",null,"Suggestions:"),3===this.state.suggestions.length&&s.a.createElement(fe.a,null,s.a.createElement(me.a,null,s.a.createElement(he.a,{style:{float:"right"}},s.a.createElement(G.a,{onClick:function(){return e.setMatch(e.state.suggestions[0].match_key)},bsStyle:"primary"},"Select")),s.a.createElement("p",{style:{paddingTop:"4px"}},this.state.suggestions[0].match_name)),s.a.createElement(me.a,null,s.a.createElement(he.a,{style:{float:"right"}},s.a.createElement(G.a,{onClick:function(){return e.setMatch(e.state.suggestions[1].match_key)},bsStyle:"primary"},"Select")),s.a.createElement("p",{style:{paddingTop:"4px"}},this.state.suggestions[1].match_name)),s.a.createElement(me.a,null,s.a.createElement(he.a,{style:{float:"right"}},s.a.createElement(G.a,{onClick:function(){return e.setMatch(e.state.suggestions[2].match_key)},bsStyle:"primary"},"Select")),s.a.createElement("p",{style:{paddingTop:"4px"}},this.state.suggestions[2].match_name))),s.a.createElement("br",null),s.a.createElement("h4",null,"Search for match:"),s.a.createElement(de,{suggestions:this.state.searchArray,handler:this.setMatchFromSearch}),s.a.createElement("br",null),""!==this.state.match&&s.a.createElement("h4",null,"Selected student key: ",this.state.match)),s.a.createElement(oe.a.Footer,null,s.a.createElement(G.a,{onClick:this.onCancel},"Cancel"),s.a.createElement(G.a,{onClick:this.onSubmit,bsStyle:"primary"},"Save")))}}]),t}(s.a.Component),Be=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(G.a,{bsStyle:"link",onClick:function(){return e.props.CustomFunction(e.props.row.id)}},"Assign Student Key"))}}]),t}(s.a.Component),Je=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).handleChange=function(t){var a=t.target.files[0];!e.props.extension||a.name.indexOf(e.props.extension)>=0?e.setState({file:a,error:""}):e.setState({error:"Invalid file type"})},e.state={file:void 0,error:""},e.submit=e.submit.bind(Object(Y.a)(Object(Y.a)(e))),e}return Object(d.a)(t,e),Object(c.a)(t,[{key:"submit",value:function(){void 0!==this.state.file&&(this.props.upload(this.state.file),this.setState({file:void 0}))}},{key:"render",value:function(){return s.a.createElement(le.a,null,s.a.createElement(z.a,null,s.a.createElement(Q.a,{style:{display:"inline-block"}},this.props.label)," ",s.a.createElement(q.a,{style:{display:"inline-block"}},s.a.createElement("input",{style:{display:"inline-block"},onChange:this.handleChange,placeholder:null,type:"file"}))," ",s.a.createElement(G.a,{style:{display:"inline-block"},onClick:this.submit},"Upload")),""!==this.state.error&&s.a.createElement(se.a,{bsStyle:"danger"},"Error: ",this.state.error))}}]),t}(s.a.Component),Ke=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={unmatchedStudents:[],citySpanStudents:[],suggestions:[],showModal:!1,focusedStudent:-1},a.openModal=a.openModal.bind(Object(Y.a)(Object(Y.a)(a))),a.closeModal=a.closeModal.bind(Object(Y.a)(Object(Y.a)(a))),a.handleRowClick=a.handleRowClick.bind(Object(Y.a)(Object(Y.a)(a))),a.handleSearch=a.handleSearch.bind(Object(Y.a)(Object(Y.a)(a))),a.handleCSVUpload=a.handleCSVUpload.bind(Object(Y.a)(Object(Y.a)(a))),a.processCSV=a.processCSV.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t,a,n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M("".concat(j,"://").concat(C,"/api/suggestions/unmatchedstudents/"));case 3:return t=e.sent,e.next=6,M("".concat(j,"://").concat(C,"/api/suggestions/cityspanstudents/"));case 6:a=e.sent,n=this.makeSuggestionsArray(t),this.setState({unmatchedStudents:t,suggestions:n,showModal:!1,focusedStudent:-1,citySpanStudents:a}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0);case 14:case"end":return e.stop()}},e,this,[[0,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"handleCSVUpload",value:function(e){var t=this;a(59).parse(e,{error:this.tmpfail,fastMode:!0,complete:function(e,a){return t.processCSV(e)},header:!0})}},{key:"processCSV",value:function(e){var t=[];for(var a in e.data){var n=e.data[a];""!==n["Student Key"]&&null!==n["Student Key"]&&void 0!==n["Student Key"]&&t.push({first_name:n["First Name"],last_name:n["Last Name"],student_key:n["Student Key"]})}x("".concat(j,"://").concat(C,"/api/suggestions/cityspanstudents/"),{students:t}).then(function(e){"error"in e&&e.response.then(function(e){alert(e.error)})})}},{key:"tmpfail",value:function(e,t){console.log(e)}},{key:"handleRowClick",value:function(e){this.setState({focusedStudent:e,showModal:!0})}},{key:"openModal",value:function(){this.setState({showModal:!0})}},{key:"closeModal",value:function(e){for(var t=this.state.unmatchedStudents,a=0;a<t.length;a++)t[a].id===e&&t.splice(a,1);this.setState({showModal:!1,unmatchedStudents:t})}},{key:"handleSearch",value:function(e,t){this.setState({focusedStudent:t,showModal:!0})}},{key:"makeSuggestionsArray",value:function(e){var t,a,n,s=[];for(var r in e)e[r].last_name.includes(" ")?(t=(n=e[r].last_name.split(" "))[0],a=n[1]):(t=e[r].last_name,a=""),s.push({firstName:e[r].first_name,lastName1:t,lastName2:a,id:e[r].id});return s}},{key:"updateStudents",value:function(e){for(var t=this.state.unmatchedStudents,a=0;a<t.length;a++)t[a].id===e&&t.splice(a,1);this.setState({unmatchedStudents:t})}},{key:"render",value:function(){var e=this.state.unmatchedStudents.map(function(e){return{name:"".concat(e.first_name," ").concat(e.last_name),id:e.id}}).sort(function(e,t){return e.name.localeCompare(t.name)}),t=[{accessor:"name",label:"Name",priorityLevel:1,position:1,minWidth:50,sortable:!0},{accessor:"edit",label:"",priorityLevel:2,position:5,CustomComponent:Be,minWidth:50,sortable:!1}];return s.a.createElement("div",{className:"content"},s.a.createElement("h1",null,"Students Without Student Keys"),s.a.createElement(Le,{show:this.state.showModal,studentID:this.state.focusedStudent,citySpanStudents:this.state.citySpanStudents,onClose:this.closeModal}),s.a.createElement("br",null),s.a.createElement("div",{style:{display:"inline-block"}},s.a.createElement(de,{suggestions:this.state.suggestions,handler:this.handleSearch})),s.a.createElement("div",{style:{float:"right"}},s.a.createElement(Je,{extension:".csv",label:"Upload Cityspan Student CSV:",upload:this.handleCSVUpload})),s.a.createElement(te.a,{rows:e,columns:t,column:"name",direction:"descending",showPagination:!0,callbacks:{edit:this.handleRowClick}}))}}]),t}(s.a.Component),Ye=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={row:{}},a.handleButtonClick=a.handleButtonClick.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({row:this.props.row})}},{key:"handleButtonClick",value:function(){var e=this;e.props.CustomFunction(e.state.row.ordering,"down")}},{key:"componentDidUpdate",value:function(){this.props.row.activity_id!==this.state.row.activity_id&&this.setState({row:this.props.row})}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(G.a,{onClick:this.handleButtonClick},"Shift Down"))}}]),t}(s.a.Component),qe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={row:{}},a.handleButtonClick=a.handleButtonClick.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({row:this.props.row})}},{key:"handleButtonClick",value:function(){var e=this;e.props.CustomFunction(e.state.row.ordering,"up")}},{key:"componentDidUpdate",value:function(){this.props.row.activity_id!==this.state.row.activity_id&&this.setState({row:this.props.row})}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(G.a,{bsStyle:"primary",onClick:this.handleButtonClick},"Shift Up"))}}]),t}(s.a.Component),ze=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).toggleCheckbox=function(){var e=Object(Y.a)(Object(Y.a)(a)),t={activity_id:e.state.row.activity_id,is_showing:!e.state.checked};x("".concat(j,"://").concat(C,"/api/activities/"),t).then(function(t){if("error"in t)t.response.then(function(e){alert("Error: ".concat(e.error))});else{e.props.CustomFunction(t)}})},a.state={row:{},checked:!1},a.toggleCheckbox=a.toggleCheckbox.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({row:this.props.row,checked:this.props.row.is_showing})}},{key:"componentDidUpdate",value:function(){this.props.row.activity_id!==this.state.row.activity_id?this.setState({row:this.props.row}):this.props.row.is_showing!==this.state.checked&&this.setState({checked:this.props.row.is_showing})}},{key:"render",value:function(){return s.a.createElement("span",{className:"checkbox"},s.a.createElement("label",null,s.a.createElement("input",{type:"checkbox",checked:this.state.checked,onChange:this.toggleCheckbox})))}}]),t}(n.Component),Qe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleChange=function(e){var t=e.target.name,n=e.target.value;a.setState(function(e){var a=Object(ae.a)({},e);return a[t]=n,a})},a.handleCheckbox=function(e){a.setState({inUse:!a.state.inUse})},a.state={show:!1,name:"",type:"boolean",inUse:!0,lastOrdering:0,error:!1,errorMsg:""},a.cancel=a.cancel.bind(Object(Y.a)(Object(Y.a)(a))),a.submit=a.submit.bind(Object(Y.a)(Object(Y.a)(a))),a.handleChange=a.handleChange.bind(Object(Y.a)(Object(Y.a)(a))),a.validateInput=a.validateInput.bind(Object(Y.a)(Object(Y.a)(a))),a.handleCheckbox=a.handleCheckbox.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(){this.props.show!==this.state.show&&this.setState({show:this.props.show,lastOrdering:this.props.lastOrdering})}},{key:"validateInput",value:function(){var e=this.state.name;return e.length>0&&/^[a-z0-9 .@+\-_]+$/i.test(e)&&this.state.type?"success":0===e.length?null:"error"}},{key:"cancel",value:function(){this.setState({name:"",type:"boolean",inUse:!0,lastOrdering:0,error:!1,errorMsg:""}),this.props.onSubmit()}},{key:"submit",value:function(){var e=this;if("success"===e.validateInput()){var t={name:e.state.name,ordering:e.state.lastOrdering+1,is_showing:e.state.inUse,type:e.state.type};_("".concat(j,"://").concat(C,"/api/activities/"),t).then(function(t){if("error"in t){if(400===t.error){return void e.setState({error:!0,errorMsg:"Creation failed due to invalid input. Please check your fields and try again"})}t.response.then(function(t){e.setState({error:!0,errorMsg:t.error})})}else e.setState({name:"",type:"boolean",inUse:!0,lastOrdering:0,error:!1,errorMsg:""}),e.props.onSubmit(t)})}else{e.setState({error:!0,errorMsg:"Invalid input. Please check your fields and try again."})}}},{key:"render",value:function(){return s.a.createElement(oe.a,{show:this.props.show},s.a.createElement(oe.a.Header,null,s.a.createElement(oe.a.Title,null,"Create New Activity")),s.a.createElement(oe.a.Body,null,s.a.createElement("form",null,s.a.createElement(z.a,{validationState:this.validateInput()},s.a.createElement(Q.a,null,"Activity Name"),s.a.createElement($.a,{type:"text",name:"name",value:this.state.name,placeholder:"Activity Name",onChange:this.handleChange}),s.a.createElement("br",null),s.a.createElement($.a,{componentClass:"select",name:"type",onChange:this.handleChange,defaultValue:this.state.type},s.a.createElement("option",{value:"boolean"},"Checkbox"),s.a.createElement("option",{value:"string"},"Text"),s.a.createElement("option",{value:"float"},"Number")),s.a.createElement("br",null),s.a.createElement(Q.a,null,"Currently in Use"),s.a.createElement($.a,{type:"checkbox",checked:this.state.inUse,value:this.state.inUse,onChange:this.handleCheckbox}),s.a.createElement($.a.Feedback,null)))),s.a.createElement(oe.a.Footer,null,this.state.error&&s.a.createElement(X.a,{bsStyle:"danger"},this.state.errorMsg),s.a.createElement(G.a,{onClick:this.cancel},"Cancel"),s.a.createElement(G.a,{onClick:this.submit,bsStyle:"primary"},"Create")))}}]),t}(s.a.Component),$e=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleChange=function(e){var t=e.target.name,n=e.target.value;a.setState(function(e){var a=Object(ae.a)({},e);return a[t]=n,a})},a.state={activities:[],showModal:!1},a.patchActivityOrder=a.patchActivityOrder.bind(Object(Y.a)(Object(Y.a)(a))),a.createNewActivity=a.createNewActivity.bind(Object(Y.a)(Object(Y.a)(a))),a.swapOrder=a.swapOrder.bind(Object(Y.a)(Object(Y.a)(a))),a.updateCheckbox=a.updateCheckbox.bind(Object(Y.a)(Object(Y.a)(a))),a.getDataTypeName=a.getDataTypeName.bind(Object(Y.a)(Object(Y.a)(a))),a.handleChange=a.handleChange.bind(Object(Y.a)(Object(Y.a)(a))),a.openModal=a.openModal.bind(Object(Y.a)(Object(Y.a)(a))),a.closeModal=a.closeModal.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M("".concat(j,"://").concat(C,"/api/activities/"));case 3:t=e.sent,this.setState({activities:t}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"createNewActivity",value:function(e){return{activity_id:e.activity_id,type:e.type,ordering:e.ordering,is_showing:e.is_showing,name:e.name}}},{key:"patchActivityOrder",value:function(e,t){var a=this.state.activities,n=this,s={activity_id1:e,activity_id2:t};x("".concat(j,"://").concat(C,"/api/activities/"),s).then(function(e){if("error"in e)e.response.then(function(e){alert("Error: ".concat(e.error))});else{var t=e[0],s=e[1];t&&s&&((a=(a=a.filter(function(e){return e.activity_id!==t.activity_id})).filter(function(e){return e.activity_id!==s.activity_id})).push(n.createNewActivity(t)),a.push(n.createNewActivity(s))),n.setState({activities:a})}})}},{key:"swapOrder",value:function(e,t){var a=this.state.activities;if(null!==e&&"up"===t&&e>1){var n=a.find(function(t){return t.ordering===e}),s=a.find(function(t){return t.ordering===e-1});this.patchActivityOrder(n.activity_id,s.activity_id)}else if(null!==e&&"down"===t&&e<a.length){var r=a.find(function(t){return t.ordering===e}),i=a.find(function(t){return t.ordering===e+1});this.patchActivityOrder(r.activity_id,i.activity_id)}}},{key:"updateCheckbox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.state.activities;null!==e&&(t=t.filter(function(t){return t.activity_id!==e.activity_id})).push(this.createNewActivity(e)),this.setState({activities:t})}},{key:"getDataTypeName",value:function(e){return"boolean"===e?"Checkbox":"string"===e?"Text":"float"===e?"Number":e}},{key:"openModal",value:function(){this.setState({showModal:!0})}},{key:"closeModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.state.activities;null!==e&&t.push(this.createNewActivity(e)),this.setState({showModal:!1,activities:t})}},{key:"render",value:function(){var e=this,t=this.state.activities.map(function(t){return{name:t.name,ordering:t.ordering,is_showing:t.is_showing,activity_id:t.activity_id,type:t.type,type_name:e.getDataTypeName(t.type)}}).sort(function(e,t){return e.ordering-t.ordering}),a=[{accessor:"name",label:"Activity",priorityLevel:1,position:1,minWidth:100,sortable:!1},{accessor:"type_name",label:"Data Type",priorityLevel:2,position:2,minWidth:100,sortable:!1},{accessor:"is_showing",label:"Currently in Use",priorityLevel:3,position:3,CustomComponent:ze,minWidth:50,sortable:!1},{accessor:"up",label:"",priorityLevel:4,position:4,CustomComponent:qe,minWidth:100,sortable:!1},{accessor:"down",label:"",priorityLevel:5,position:5,CustomComponent:Ye,minWidth:50,sortable:!1}],n={up:this.swapOrder,down:this.swapOrder,is_showing:this.updateCheckbox};return s.a.createElement("div",{className:"content"},s.a.createElement("h1",null,"Programming"),s.a.createElement(he.a,{style:{float:"right"}},s.a.createElement(G.a,{onClick:this.openModal},"New Activity")),s.a.createElement(Qe,{show:this.state.showModal,lastOrdering:this.state.activities.length,onSubmit:this.closeModal}),s.a.createElement(te.a,{rows:t,columns:a,column:"name",direction:"descending",showPagination:!0,callbacks:n}))}}]),t}(s.a.Component),Ge=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleChange=function(e){var t=e.target.name,n=e.target.value;a.setState(function(e){var a=Object(ae.a)({},e);return a[t]=n,a})},a.handleInUseCheckbox=function(e){a.setState({inUse:!a.state.inUse})},a.handleQuickAddCheckbox=function(e){a.setState({quickAdd:!a.state.quickAdd})},a.state={show:!1,name:"",type:"str",inUse:!0,quickAdd:!1,error:!1,errorMsg:""},a.cancel=a.cancel.bind(Object(Y.a)(Object(Y.a)(a))),a.submit=a.submit.bind(Object(Y.a)(Object(Y.a)(a))),a.handleChange=a.handleChange.bind(Object(Y.a)(Object(Y.a)(a))),a.validateInput=a.validateInput.bind(Object(Y.a)(Object(Y.a)(a))),a.handleInUseCheckbox=a.handleInUseCheckbox.bind(Object(Y.a)(Object(Y.a)(a))),a.handleQuickAddCheckbox=a.handleQuickAddCheckbox.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(){this.props.show!==this.state.show&&this.setState({show:this.props.show})}},{key:"validateInput",value:function(){var e=this.state.name;return e.length>0&&/^[a-z0-9.@+\- _]+$/i.test(e)&&this.state.type?"success":0===e.length?null:"error"}},{key:"cancel",value:function(){this.setState({name:"",type:"str",inUse:!0,quickAdd:!1,error:!1,errorMsg:""}),this.props.onSubmit()}},{key:"submit",value:function(){var e=this;if("success"===e.validateInput()){var t={name:e.state.name,is_showing:e.state.inUse,quick_add:e.state.quickAdd,type:e.state.type};_("".concat(j,"://").concat(C,"/api/student_column/"),t).then(function(t){if("error"in t){if(400===t.error){return void e.setState({error:!0,errorMsg:"Creation failed due to invalid input. Please check your fields and try again"})}t.response.then(function(t){e.setState({error:!0,errorMsg:t.error})})}else e.setState({name:"",type:"str",inUse:!0,quickAdd:!1,error:!1,errorMsg:""}),e.props.onSubmit(t)})}else{e.setState({error:!0,errorMsg:"Invalid input. Please check your fields and try again."})}}},{key:"render",value:function(){return s.a.createElement(oe.a,{show:this.props.show},s.a.createElement(oe.a.Header,null,s.a.createElement(oe.a.Title,null,"Create New Student Field")),s.a.createElement(oe.a.Body,null,s.a.createElement("form",null,s.a.createElement(z.a,{validationState:this.validateInput()},s.a.createElement(Q.a,null,"Field Name"),s.a.createElement($.a,{type:"text",name:"name",value:this.state.name,placeholder:"Field Name",onChange:this.handleChange}),s.a.createElement("br",null),s.a.createElement($.a,{componentClass:"select",name:"type",onChange:this.handleChange,defaultValue:this.state.type},s.a.createElement("option",{value:"date"},"Date"),s.a.createElement("option",{value:"str"},"Text"),s.a.createElement("option",{value:"int"},"Number")),s.a.createElement("br",null),s.a.createElement(Q.a,null,"Currently in Use"),s.a.createElement($.a,{type:"checkbox",checked:this.state.inUse,value:this.state.inUse,onChange:this.handleInUseCheckbox}),s.a.createElement("br",null),s.a.createElement(Q.a,null,"Show in Quick Add"),s.a.createElement($.a,{type:"checkbox",checked:this.state.quickAdd,value:this.state.quickAdd,onChange:this.handleQuickAddCheckbox}),s.a.createElement($.a.Feedback,null)))),s.a.createElement(oe.a.Footer,null,this.state.error&&s.a.createElement(X.a,{bsStyle:"danger"},this.state.errorMsg),s.a.createElement(G.a,{onClick:this.cancel},"Cancel"),s.a.createElement(G.a,{onClick:this.submit,bsStyle:"primary"},"Create")))}}]),t}(s.a.Component),Xe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).toggleCheckbox=function(){var e=Object(Y.a)(Object(Y.a)(a)),t={info_id:e.state.row.info_id};t[e.props.accessor]=!e.state.checked,x("".concat(j,"://").concat(C,"/api/student_column/"),t).then(function(t){if("error"in t)t.response.then(function(e){alert("Error: ".concat(e.error))});else{e.props.CustomFunction(t)}})},a.state={row:{},checked:!1},a.toggleCheckbox=a.toggleCheckbox.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){"is_showing"===this.props.accessor?this.setState({row:this.props.row,checked:this.props.row.is_showing}):"quick_add"===this.props.accessor&&this.setState({row:this.props.row,checked:this.props.row.quick_add})}},{key:"componentDidUpdate",value:function(){this.props.row.info_id!==this.state.row.info_id&&this.setState({row:this.props.row}),"is_showing"===this.props.accessor&&this.props.row.is_showing!==this.state.checked?this.setState({checked:this.props.row.is_showing}):"quick_add"===this.props.accessor&&this.props.row.quick_add!==this.state.checked&&this.setState({checked:this.props.row.quick_add})}},{key:"render",value:function(){return s.a.createElement("span",{className:"checkbox"},s.a.createElement("label",null,s.a.createElement("input",{type:"checkbox",checked:this.state.checked,onChange:this.toggleCheckbox})))}}]),t}(n.Component),Ze=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleChange=function(e){var t=e.target.name,n=e.target.value;a.setState(function(e){var a=Object(ae.a)({},e);return a[t]=n,a})},a.state={fields:[],showModal:!1},a.createNewField=a.createNewField.bind(Object(Y.a)(Object(Y.a)(a))),a.updateCheckbox=a.updateCheckbox.bind(Object(Y.a)(Object(Y.a)(a))),a.getDataTypeName=a.getDataTypeName.bind(Object(Y.a)(Object(Y.a)(a))),a.handleChange=a.handleChange.bind(Object(Y.a)(Object(Y.a)(a))),a.openModal=a.openModal.bind(Object(Y.a)(Object(Y.a)(a))),a.closeModal=a.closeModal.bind(Object(Y.a)(Object(Y.a)(a))),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(w.a)(k.a.mark(function e(){var t;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M("".concat(j,"://").concat(C,"/api/student_column/"));case 3:t=e.sent,this.setState({fields:t}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"createNewField",value:function(e){return{info_id:e.info_id,is_showing:e.is_showing,quick_add:e.quick_add,name:e.name,type:e.type}}},{key:"updateCheckbox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.state.fields;null!==e&&(t=t.filter(function(t){return t.info_id!==e.info_id})).push(this.createNewField(e)),this.setState({fields:t})}},{key:"getDataTypeName",value:function(e){return"date"===e?"Date":"str"===e?"Text":"int"===e?"Number":e}},{key:"openModal",value:function(){this.setState({showModal:!0})}},{key:"closeModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.state.fields;null!==e&&t.push(this.createNewField(e)),this.setState({showModal:!1,fields:t})}},{key:"render",value:function(){var e=this,t=this.state.fields.map(function(t){return{name:t.name,is_showing:t.is_showing,info_id:t.info_id,type:t.type,type_name:e.getDataTypeName(t.type),quick_add:t.quick_add}}).sort(function(e,t){return e.name.localeCompare(t.name)}),a=[{accessor:"name",label:"Field",priorityLevel:1,position:1,minWidth:100,sortable:!1},{accessor:"type_name",label:"Data Type",priorityLevel:2,position:2,minWidth:100,sortable:!1},{accessor:"is_showing",label:"Currently in Use",priorityLevel:3,position:3,CustomComponent:Xe,minWidth:50,sortable:!1},{accessor:"quick_add",label:"Show in Quick Add",priorityLevel:4,position:4,CustomComponent:Xe,minWidth:50,sortable:!1}],n={is_showing:this.updateCheckbox,quick_add:this.updateCheckbox};return s.a.createElement("div",{className:"content"},s.a.createElement("h1",null,"Student Profile Fields"),s.a.createElement(he.a,{style:{float:"right"}},s.a.createElement(G.a,{onClick:this.openModal},"New Student Profile Field")),s.a.createElement(Ge,{show:this.state.showModal,onSubmit:this.closeModal}),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement(te.a,{rows:t,columns:a,column:"name",direction:"descending",showPagination:!0,callbacks:n}))}}]),t}(s.a.Component),et=function(e){function t(e,a){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e,a))).handleSelect=n.handleSelect.bind(Object(Y.a)(Object(Y.a)(n))),n.toggleRefreshRoles=n.toggleRefreshRoles.bind(Object(Y.a)(Object(Y.a)(n))),n.state={refreshRoles:!1,key:1},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handleSelect",value:function(e){this.setState({key:e})}},{key:"toggleRefreshRoles",value:function(e){this.setState({refreshRoles:e})}},{key:"render",value:function(){var e=[],t=1,a=V();return a.indexOf("view_user")>=0&&(e.push(s.a.createElement(Ce.a,{key:t,eventKey:t,title:"User Management"},s.a.createElement(Fe,{toggleRefreshRoles:this.toggleRefreshRoles,refreshRoles:this.state.refreshRoles}))),t++),a.indexOf("view_group")>=0&&(e.push(s.a.createElement(Ce.a,{key:t,eventKey:t,title:"User Roles"},s.a.createElement(He,{toggleRefreshRoles:this.toggleRefreshRoles}))),t++),(a.indexOf("change_activity")>=0||a.indexOf("add_activity")>=0)&&(e.push(s.a.createElement(Ce.a,{key:t,eventKey:t,title:"Programming"},s.a.createElement($e,null))),t++),(a.indexOf("change_studentcolumn")>=0||a.indexOf("add_studentcolumn")>=0)&&(e.push(s.a.createElement(Ce.a,{key:t,eventKey:t,title:"Student Profile Fields"},s.a.createElement(Ze,null))),t++),a.indexOf("change_cityspanstudents")>=0&&(e.push(s.a.createElement(Ce.a,{key:t,eventKey:t,title:"Student Key Management"},s.a.createElement(Ke,null))),t++),s.a.createElement(Ee.a,{activeKey:this.state.key,onSelect:this.handleSelect,id:"admin-tabs"},e)}}]),t}(s.a.Component),tt=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=V();return e.indexOf("view_user")>=0||e.indexOf("view_group")>=0||e.indexOf("change_activity")>=0||e.indexOf("add_activity")>=0||e.indexOf("change_studentcolumn")>=0||e.indexOf("add_studentcolumn")>=0?s.a.createElement("div",{className:"content"},s.a.createElement(et,null)):s.a.createElement(S.a,{to:"/attendance"})}}]),t}(s.a.Component),at=a(219),nt=a(218),st=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"content"},s.a.createElement(nt.a,null,s.a.createElement("div",{className:"content-jumbotron"},s.a.createElement("h1",null,"404 ",s.a.createElement("small",null,"page not found")),s.a.createElement("p",null,"The page you're looking for has mysteriously disappeared! Try navigating from ",s.a.createElement(at.a,{to:"/attendance"},"the home page")," to take another look."))))}}]),t}(s.a.Component),rt=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement(K,{show:"/"!==this.props.location.pathname},s.a.createElement(h.a,null,s.a.createElement(p.a,{exact:!0,path:"/",component:Z}),s.a.createElement(p.a,{exact:!0,path:"/attendance",render:function(){return R(pe)}}),s.a.createElement(p.a,{path:"/students",component:function(e){return R(Oe)}})," ",s.a.createElement(p.a,{path:"/reports",render:function(){return R(Me)}}),s.a.createElement(p.a,{path:"/admin",render:function(){return R(tt)}}),s.a.createElement(p.a,{render:function(){return R(st)}})))}}]),t}(s.a.Component),it=Object(m.a)(rt),ot=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(it,{history:E}))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ct=a(225);i.a.render(s.a.createElement(ct.a,null,s.a.createElement(ot,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[104,2,1]]]);
//# sourceMappingURL=main.6cb6c19b.chunk.js.map